!function(e){function t(e){var t=e.originalEvent.changedTouches[0],a="";switch(e.type){case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var i=document.createEvent("MouseEvent");i.initMouseEvent(a,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(i),e.preventDefault()}e.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}},e.fn.rateit=function(a,i){var r=1,n={},s="init",l=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(0===this.length)return this;var d=e.type(a);if("object"==d||null==a)n=e.extend({},e.fn.rateit.defaults,a);else{if("string"==d&&"reset"!==a&&void 0===i)return this.data("rateit"+l(a));"string"==d&&(s="setvalue")}return this.each(function(){var d=e(this),h=function(e,t){if(null!=t){var a="aria-value"+("value"==e?"now":e),i=d.find(".rateit-range");null!=i.attr(a)&&i.attr(a,t)}return arguments[0]="rateit"+l(e),d.data.apply(d,arguments)};if("reset"==a){var o=h("init");for(var u in o)d.data(u,o[u]);if(h("backingfld"))(m=e(h("backingfld"))).val(h("value")),m.trigger("change"),m[0].min&&(m[0].min=h("min")),m[0].max&&(m[0].max=h("max")),m[0].step&&(m[0].step=h("step"));d.trigger("reset")}d.hasClass("rateit")||d.addClass("rateit");var v="rtl"!=d.css("direction");if("setvalue"==s){if(!h("init"))throw"Can't set value before init";if("readonly"!=a||1!=i||h("readonly")||(d.find(".rateit-range").unbind(),h("wired",!1)),"value"==a&&(i=null==i?h("min"):Math.max(h("min"),Math.min(h("max"),i))),h("backingfld")){var m=e(h("backingfld"));"value"==a&&m.val(i),"min"==a&&m[0].min&&(m[0].min=i),"max"==a&&m[0].max&&(m[0].max=i),"step"==a&&m[0].step&&(m[0].step=i)}h(a,i)}if(!h("init")){if(h("min",isNaN(h("min"))?n.min:h("min")),h("max",isNaN(h("max"))?n.max:h("max")),h("step",h("step")||n.step),h("readonly",void 0!==h("readonly")?h("readonly"):n.readonly),h("resetable",void 0!==h("resetable")?h("resetable"):n.resetable),h("backingfld",h("backingfld")||n.backingfld),h("starwidth",h("starwidth")||n.starwidth),h("starheight",h("starheight")||n.starheight),h("value",Math.max(h("min"),Math.min(h("max"),isNaN(h("value"))?isNaN(n.value)?n.min:n.value:h("value")))),h("ispreset",void 0!==h("ispreset")?h("ispreset"):n.ispreset),h("backingfld"))if(((m=e(h("backingfld")).hide()).attr("disabled")||m.attr("readonly"))&&h("readonly",!0),"INPUT"==m[0].nodeName&&("range"!=m[0].type&&"text"!=m[0].type||(h("min",parseInt(m.attr("min"))||h("min")),h("max",parseInt(m.attr("max"))||h("max")),h("step",parseInt(m.attr("step"))||h("step")))),"SELECT"==m[0].nodeName&&m[0].options.length>1){h("min",isNaN(h("min"))?Number(m[0].options[0].value):h("min")),h("max",Number(m[0].options[m[0].length-1].value)),h("step",Number(m[0].options[1].value)-Number(m[0].options[0].value));var c=m.find("option[selected]");1==c.length&&h("value",c.val())}else h("value",m.val());var f="DIV"==d[0].nodeName?"div":"span";r++;var g='<button id="rateit-reset-{{index}}" type="button" data-role="none" class="rateit-reset" aria-label="'+e.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"></button><{{element}} id="rateit-range-{{index}}" class="rateit-range" tabindex="0" role="slider" aria-label="'+e.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+h("min")+'" aria-valuemax="'+h("max")+'" aria-valuenow="'+h("value")+'"><{{element}} class="rateit-selected" style="height:'+h("starheight")+'px"></{{element}}><{{element}} class="rateit-hover" style="height:'+h("starheight")+'px"></{{element}}></{{element}}>';d.append(g.replace(/{{index}}/gi,r).replace(/{{element}}/gi,f)),v||(d.find(".rateit-reset").css("float","right"),d.find(".rateit-selected").addClass("rateit-selected-rtl"),d.find(".rateit-hover").addClass("rateit-hover-rtl")),h("init",JSON.parse(JSON.stringify(d.data())))}d.find(".rateit-selected, .rateit-hover").height(h("starheight"));var p=d.find(".rateit-range");p.width(h("starwidth")*(h("max")-h("min"))).height(h("starheight"));var b="rateit-preset"+(v?"":"-rtl");if(h("ispreset")?d.find(".rateit-selected").addClass(b):d.find(".rateit-selected").removeClass(b),null!=h("value")){var w=(h("value")-h("min"))*h("starwidth");d.find(".rateit-selected").width(w)}var x=d.find(".rateit-reset");!0!==x.data("wired")&&x.bind("click",function(t){t.preventDefault(),x.blur();var a=e.Event("beforereset");if(d.trigger(a),a.isDefaultPrevented())return!1;d.rateit("value",null),d.trigger("reset")}).data("wired",!0);var y=function(t,a){var i=(a.changedTouches?a.changedTouches[0].pageX:a.pageX)-e(t).offset().left;return v||(i=p.width()-i),i>p.width()&&(i=p.width()),i<0&&(i=0),w=Math.ceil(i/h("starwidth")*(1/h("step")))},N=function(t){var a=e.Event("beforerated");return d.trigger(a,[t]),!a.isDefaultPrevented()&&(h("value",t),h("backingfld")&&e(h("backingfld")).val(t).trigger("change"),h("ispreset")&&(p.find(".rateit-selected").removeClass(b),h("ispreset",!1)),p.find(".rateit-hover").hide(),p.find(".rateit-selected").width(t*h("starwidth")-h("min")*h("starwidth")).show(),d.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[t]),!0)};h("readonly")?x.hide():(h("resetable")||x.hide(),h("wired")||(p.bind("touchmove touchend",t),p.mousemove(function(e){!function(e){var t=e*h("starwidth")*h("step"),a=p.find(".rateit-hover");if(a.data("width")!=t){p.find(".rateit-selected").hide(),a.width(t).show().data("width",t);var i=[e*h("step")+h("min")];d.trigger("hover",i).trigger("over",i)}}(y(this,e))}),p.mouseleave(function(e){p.find(".rateit-hover").hide().width(0).data("width",""),d.trigger("hover",[null]).trigger("over",[null]),p.find(".rateit-selected").show()}),p.mouseup(function(e){var t=y(this,e)*h("step")+h("min");N(t),p.blur()}),p.keyup(function(e){38!=e.which&&e.which!=(v?39:37)||N(Math.min(h("value")+h("step"),h("max"))),40!=e.which&&e.which!=(v?37:39)||N(Math.max(h("value")-h("step"),h("min")))}),h("wired",!0)),h("resetable")&&x.show()),p.attr("aria-readonly",h("readonly"))})},e.fn.rateit.defaults={min:0,max:5,step:.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1},e(function(){e("div.rateit, span.rateit").rateit()})}(jQuery);