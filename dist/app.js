"use strict";var app=function(){function e(e){for(var o=Array.prototype.slice.call(arguments,1),t=0,n=o.length;t<n;t++){if(!e||!e.hasOwnProperty(o[t]))return!1;e=e[o[t]]}return!0}String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var o=Date.now||function(){return(new Date).getTime()};function t(e,t,n){var r,a,i,l=null,s=0;n||(n={});var c=function(){s=!1===n.leading?0:o(),l=null,i=e.apply(r,a),l||(r=a=null)};return function(){var u=o();s||!1!==n.leading||(s=u);var d=t-(u-s);return r=this,a=arguments,d<=0||d>t?(l&&(clearTimeout(l),l=null),s=u,i=e.apply(r,a),l||(r=a=null)):l||!1===n.trailing||(l=setTimeout(c,d)),i}}var n=t(function(e){e.perfectScrollbar("update")},16,{leading:!1});function r(o,t,n,r,a,i){if(null==o)return!1;if(o.constructor===Array){if(void 0===o[0])return!1;if(!0!==e.apply(void 0,o))return!1;for(var l=o[0],s=1,c=o.length;s<c;s++)l=l[o[s]];o=l}return void 0!==t&&(o=ko.bindingHandlers[t].update(n,o,r,a,i,!0)),o}function a(e,o,t,n,r,a){setTimeout(function(){var r,i,l,s,c,u,d=0,g=0;if(!0===t){var p=$("#marker-list");(window.innerWidth>1199||!0===p.hasClass("panel-visible"))&&p.width()+p.offset().left+e.width()+a+20<window.innerWidth&&e.offset().left<p.width()+p.offset().left+10&&(d=p.width()+p.offset().left-e.offset().left+10)}!0===n&&e.offset().top<0&&(g=e.offset().top-15),0===d&&0===g||(r=o.marker().map,i=void 0,l=d,s=g,c=r.getProjection().fromLatLngToPoint(i instanceof google.maps.LatLng?i:r.getCenter()),u=new google.maps.Point(("number"==typeof l?l:0)/Math.pow(2,r.getZoom())||0,("number"==typeof s?s:0)/Math.pow(2,r.getZoom())||0),r.setCenter(r.getProjection().fromPointToLatLng(new google.maps.Point(c.x-u.x,c.y+u.y))))},void 0!==r?r:0)}function i(e,o){e.hide(o,function(){e.unbind("click",l),e.remove()})}function l(e){i($(e.currentTarget),50)}function s(e,o){n($(o)),function(e){$(e).unbind("mouseenter",s)}(o)}function c(e,o){var t=this;t.googleSearchType=ko.observable(o),t.googleIsLoading=ko.observable(!1),t.isInViewOnMap=ko.observable(!0),t.isListed=ko.observable(!1),t.isSelected=ko.observable(!1),t.hasBeenOpened=!1,t.modelNumber=e.getLocationModelNumber(),t.isFavorite=ko.observable(!1),t.disposableArray=[],t.listenerStorage=[],e.modelConstructor(t),e.modelSearchTypeConstructor(t),t.marker=ko.observable(new google.maps.Marker({map:e.mainMap,opacity:!1===t.isListed()?e.lowMarkerOpacity():appConfigObject.highMarkerOpacity,icon:e.markerImageCreator(),shape:appConfigObject.defaultMarkerShape})),t.disposableArray.push(t.isFavorite.subscribe(function(o){t.marker().setIcon(e.markerImageCreator(o,t.google_priceLevel())),t.marker(t.marker()),e.changeFavoriteArray(o,t)})),t.disposableArray.push(t.isSelected.subscribe(function(o){e.changeCurrentlySelectedItem(o,t)})),t.disposableArray.push(t.isListed.subscribe(function(o){o?(t.marker().setOpacity(appConfigObject.highMarkerOpacity),t.marker(t.marker())):(t.marker().setOpacity(e.lowMarkerOpacity()),t.marker(t.marker()))})),t.disposableArray.push(t.google_priceLevel.subscribe(function(o){t.marker().setIcon(e.markerImageCreator(t.isFavorite(),o)),t.marker(t.marker())})),t.disposableArray.push(t.google_name.subscribe(function(e){t.marker().setTitle(e),t.marker(t.marker())})),t.disposableArray.push(t.google_geometry.subscribe(function(e){t.marker().setPosition(e.location),t.marker(t.marker())})),t.isItOpenRightNow=ko.pureComputed(function(){if(void 0!==t.google_openingHoursObject()){if(!0===t.google_openingHoursObject().open_now)return"Open";if(!1===t.google_openingHoursObject().open_now)return"Closed"}}),t.infoWindow=new google.maps.InfoWindow({content:e.makeInfoWindowContent()}),t.listenerStorage.push(t.infoWindow.addListener("closeclick",e.markerCloseClick)),t.listenerStorage.push(t.infoWindow.addListener("domready",e.markerDomReady)),t.listenerStorage.push(t.marker().addListener("click",function(){e.markerClick(t)})),t.listWasClicked=function(o,n,r){new google.maps.event.trigger(t.marker(),"click"),t.marker().map.panTo(t.google_geometry().location),r<1200&&e.markerToggled(!1)},t.searchType=function(e){return t[e.toLowerCase()+"SearchType"]},t.dispose=function(){t.marker().setMap(null),ko.utils.arrayForEach(t.disposableArray,function(e){e.dispose()}),ko.utils.arrayForEach(t.listenerStorage,function(e){google.maps.event.removeListener(e)})}}function u(n){var r,i,l,s,u,d,g,p,f,m=this;m.mainMap=n,m.mainMapCenter=ko.observable(),m.service=new google.maps.places.PlacesService(m.mainMap),m.storageAvailable=function(e){try{var o=window[e],t="__storage_test__";return o.setItem(t,t),o.removeItem(t),!0}catch(e){return!1}}("localStorage"),m.workersAvailable="undefined"!=typeof Worker&&"file:"!==window.location.protocol,m.maxMarkerLimit=ko.observable(appConfigObject.maxMarkerLimit),m.lowMarkerOpacity=ko.observable(appConfigObject.lowMarkerOpacity),m.APIMappingsForModel=appConfigObject.APIMappingsForModel,m.APIConfiguredSearchTypes=appConfigObject.configuredSearchTypes,m.defaultMarkerImage={size:new google.maps.Size(appConfigObject.markerImageSize[0],appConfigObject.markerImageSize[1]),origin:new google.maps.Point(appConfigObject.markerImageOrigin[0],appConfigObject.markerImageOrigin[1]),anchor:new google.maps.Point(appConfigObject.markerImageAnchor[0],appConfigObject.markerImageAnchor[1])},m.markedLocations=ko.observableArray([]),m.locationModelNumber=0,m.currentlySelectedLocation=ko.observable(),m.scrolledItem=ko.observable(),m.shouldScroll=ko.observable(!1),m.attributionsArray=ko.observableArray([]),m.favoriteArray=ko.observableArray([]),m.getRestaurantsFromGoogleMapsAPICallArray=[],m.currentDetailedAPIInfoBeingFetched={},m.errors=ko.observable(!1),m.verboseErrors=ko.observable(!1),m.checkNested=e,m.markerToggled=ko.observable(!1),m.optionsToggled=ko.observable(!1),m.regularInfoWindowPan=ko.observable(!1),m.userDrag=ko.observable(!1),m.currentInfoWindowCheck=void 0,m.sortType=ko.observable("count"),m.searchQuery=ko.observable(),m.priceButtonFilter=ko.observableArray(appConfigObject.defaultPriceButtonFilter),m.minRatingButtonFilter=ko.observable(appConfigObject.defaultMinRatingButtonFilter),m.openButtonFilter=ko.observable(appConfigObject.defaultOpenButtonFilter),m.favoriteButtonFilter=ko.observable(appConfigObject.defaultFavoriteButtonFilter),m.infoWindowHTMLTemplate='<div class = "info-window-template" data-bind = "infoWindowTemplate: true"></div>',m.lowMarkerOpacity.subscribe(function(e){e=Number(e).toFixed(2)/1,ko.utils.arrayForEach(m.markedLocations(),function(o){!1===o.isListed()&&o.marker().setOpacity(e)})}),m.lowMarkerOpacity.extend({numeric:2}),m.mainMapCenter.subscribe(function(e){m.setLocalStorage("mapCenter",JSON.stringify({lat:e.lat(),lng:e.lng(),zoom:m.mainMap.getZoom()}))}),m.markedLocations.subscribe(function(e){e.length>m.maxMarkerLimit()&&m.removeMultipleLocations(e)}),m.favoriteArray.subscribe(function(e){var o=[];ko.utils.arrayForEach(e,function(e){o.push(m.modelDeconstructor(e))});var t=JSON.stringify(o);0!==o.length?m.setLocalStorage("favoritesArray",t):m.setLocalStorage("favoritesArray","[]")}),m.favoriteArray.extend({rateLimit:2e3}),m.currentlySelectedLocation.subscribe((r=function(e){void 0!==e&&(m.scrollToItem(),m.userDrag(!1))},i=5,f=function(){var e=o()-g;e<i&&e>=0?s=setTimeout(f,i-e):(s=null,l||(p=r.apply(d,u),s||(d=u=null)))},function(){d=this,u=arguments,g=o();var e=l&&!s;return s||(s=setTimeout(f,i)),e&&(p=r.apply(d,u),d=u=null),p})),m.idArray=ko.pureComputed(function(){var e={all:[],nearby:[]};return ko.utils.arrayMap(m.markedLocations(),function(o){"Nearby"!==o.googleSearchType()&&"Places"!==o.googleSearchType()||e.nearby.push(o.google_placeId),e.all.push(o.google_placeId)}),e}),m.priceButtonFilterHasChanged=ko.pureComputed(function(){return!function(e,o){for(var t=0,n=e.length;t<n;t++)if(e[t]!==o[t])return!1;return!0}(m.priceButtonFilter(),[!0,!0,!0,!0,!0])}),m.listableEntries=ko.computed(function(){var e={entries:[],allNames:[]};return e.entries=ko.utils.arrayFilter(m.markedLocations(),function(o){return"Nearby"!==o.googleSearchType()&&"Places"!==o.googleSearchType()||!0!==o.isInViewOnMap()||!1!==m.isSearchFiltered(o)||!1!==m.isButtonFiltered(o)?(o.isListed(!1),!1):(o.isListed(!0),e.allNames.push(o.google_name()),!0)}),e}),m.sortedEntries=ko.pureComputed(function(){var e=m.listableEntries().entries;return"count"===m.sortType()?e.sort(function(e,o){return e.modelNumber<o.modelNumber?-1:1}):"alpha"===m.sortType()?e.sort(function(e,o){return e.google_name()===o.google_name()?0:e.google_name()<o.google_name()?-1:1}):"rating"===m.sortType()?e.sort(function(e,o){return void 0===e.google_rating()?void 0===o.google_rating()?0:1:void 0===o.google_rating()?-1:e.google_rating()<o.google_rating()?1:-1}):"distance"===m.sortType()&&e.sort(function(e,o){var t=e.google_geometry().location.lat(),n=o.google_geometry().location.lat(),r=m.mainMapCenter().lat(),a=e.google_geometry().location.lng(),i=o.google_geometry().location.lng(),l=m.mainMapCenter().lng(),s=appConfigObject.distanceBetweenTwoPointsInMeters(t,a,r,l),c=appConfigObject.distanceBetweenTwoPointsInMeters(n,i,r,l);return s===c?0:s<c?-1:1}),e}),m.listableEntries.extend({rateLimit:50}),m.initializeCurrentDetailedAPIInfoBeingFetched=function(){m.currentDetailedAPIInfoBeingFetched.findID=function(e,o,t){return this[e][o].indexOf(t)},m.currentDetailedAPIInfoBeingFetched.pushID=function(e,o,t){this[e][o].push(t),this[e][o][this[e][o].length-1][e+"IsLoading"](!0)},m.currentDetailedAPIInfoBeingFetched.removeID=function(e,o,t){var n=this.findID(e,o,t);n>-1&&(this[e][o][n][e+"IsLoading"](!1),this[e][o].splice(n,1));for(var r=0,a=this.intercept.length;r<a;r++)this.intercept[r].ID===t&&(m.getDetailedAPIData(this.intercept[r].service,this.intercept[r].ID),this.intercept.splice(r,1))},m.currentDetailedAPIInfoBeingFetched.intercept=[],m.currentDetailedAPIInfoBeingFetched.interceptIDPush=function(e,o,t){for(var n=0,r=this.intercept.length;n<r;n++)if(this.intercept.ID===t)return;this.intercept.push({ID:t,type:o,service:e})},m.currentDetailedAPIInfoBeingFetched.interceptIDRemove=function(e){for(var o=0,t=this.intercept.length;o<t;o++)this.intercept.ID===e&&this.intercept.splice(o,1)};for(var e=0,o=m.APIConfiguredSearchTypes.length;e<o;e++)m.currentDetailedAPIInfoBeingFetched[m.APIConfiguredSearchTypes[e]]={basic:[],detailed:[]};m.currentDetailedAPIInfoBeingFetched.google={detailed:[]}},m.changeCurrentlySelectedItem=function(e,o){!0===e?m.currentlySelectedLocation(o):m.currentlySelectedLocation(void 0)},m.changeFavoriteArray=function(e,o){!0===e?m.favoriteArray.push(o):m.favoriteArray.remove(o)},m.markerCloseClick=function(){void 0!==m.currentlySelectedLocation()&&(m.currentlySelectedLocation().hasBeenOpened=!1,m.currentlySelectedLocation().isSelected(!1))},m.markerDomReady=function(){m.currentlySelectedLocation().hasBeenOpened||(ko.applyBindings(m,m.currentlySelectedLocation().infoWindow.getContent()),m.currentlySelectedLocation().hasBeenOpened=!0)},m.markerClick=function(e){!0===e.hasBeenOpened&&(e.hasBeenOpened=!1),m.shouldScroll(!0),m.getDetailedGooglePlacesAPIInfo(e,m.callSearchAPIs),void 0!==m.currentlySelectedLocation()&&(m.currentlySelectedLocation().infoWindow.close(),m.currentlySelectedLocation().isSelected(!1)),e.isSelected(!0),m.markerAnimation(e),e.infoWindow.open(e.marker().map,e.marker())},m.markerAnimation=function(e){e.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker().setAnimation(null)},750)},m.markerImageCreator=function(e,o){var t=m.defaultMarkerImage;if(!0===e)return t.url=appConfigObject.markerImageURLFav,t;switch(o){case 1:return t.url=appConfigObject.markerImageURL1,t;case 2:return t.url=appConfigObject.markerImageURL2,t;case 3:return t.url=appConfigObject.markerImageURL3,t;case 4:return t.url=appConfigObject.markerImageURL4,t;default:return t.url=appConfigObject.markerImageURLEmpty,t}},m.getNavWithCallback=function(){return!!navigator.geolocation&&navigator.geolocation.getCurrentPosition(m.mapPanFromNavigation)},m.mapPanFromNavigation=function(e){m.mapPan(e.coords.latitude,e.coords.longitude),m.markerCloseClick(),m.optionsToggled(!1)},m.mapPan=function(e,o){var t=new google.maps.LatLng(e,o);m.mainMap.panTo(t)},m.modelConstructor=function(e){for(var o in m.APIMappingsForModel)for(var t=m.APIMappingsForModel[o],n=0,r=t.length;n<r;n++)1===t[n].oType?e[t[n].model]=ko.observable():2===t[n].oType&&(e[t[n].model]=ko.observableArray([]))},m.modelDeconstructor=function(e){var o={};for(var t in m.APIMappingsForModel)for(var n=m.APIMappingsForModel[t],r=0,a=n.length;r<a;r++)0===n[r].oType?o[n[r].model]=e[n[r].model]:o[n[r].model]=e[n[r].model]();return o},m.modelUpdater=function(e,o,t){for(var n=m.APIMappingsForModel[o],r=0,a=n.length;r<a;r++)void 0!==t[n[r].server]&&(0!==n[r].oType?e[n[r].model](t[n[r].server]):e[n[r].model]=t[n[r].server])},m.modelRebuilder=function(e,o,t){for(var n in m.APIMappingsForModel)for(var r=m.APIMappingsForModel[n],a=0,i=r.length;a<i;a++)if(0!==r[a].oType&&"google_geometry"!==r[a].model)e[r[a].model](o[r[a].model]);else if("google_geometry"===r[a].model){var l=o[r[a].model];l.location=t,e[r[a].model](l)}else e[r[a].model]=o[r[a].model]},m.modelSearchTypeConstructor=function(e){for(var o=0,t=m.APIConfiguredSearchTypes.length;o<t;o++)e[m.APIConfiguredSearchTypes[o].toLowerCase()+"SearchType"]=ko.observable("None"),e[m.APIConfiguredSearchTypes[o].toLowerCase()+"IsLoading"]=ko.observable(!1)},m.removeMultipleLocations=t(function(e){m.markedLocations.sort(function(e,o){return!0===e.isFavorite()?1:e.modelNumber<o.modelNumber?-1:1});for(var o=0;o<appConfigObject.markerLimitRemoveBulkAmount;o++)e[o].dispose();m.markedLocations.splice(0,appConfigObject.markerLimitRemoveBulkAmount)},1e3,{trailing:!1}),m.getLocationModelNumber=function(){return m.locationModelNumber++,m.locationModelNumber-1},m.setLocalStorage=t(function(e,o){!0===m.storageAvailable&&localStorage.setItem(e,o)},1e3,{trailing:!1}),m.locationArrayForWorkers=function(){return ko.utils.arrayMap(m.listableEntries().entries,function(e){return{lat:e.google_geometry().location.lat(),lng:e.google_geometry().location.lng(),name:e.google_name(),google_placeId:e.google_placeId}})},m.isSearchFiltered=function(e){return void 0!==m.searchQuery()&&!(e.google_name().toLowerCase().indexOf(m.searchQuery().toLowerCase())>=0)},m.isButtonFiltered=function(e){if(!0===m.priceButtonFilterHasChanged())if(void 0!==e.google_priceLevel()){for(var o=0;o<5;o++)if(!0!==m.priceButtonFilter()[o]&&e.google_priceLevel()===o)return!0}else if(!0!==m.priceButtonFilter()[0])return!0;if(0!==m.minRatingButtonFilter()){if(void 0===e.google_rating())return!0;if(e.google_rating()<m.minRatingButtonFilter())return!0}return!1!==m.openButtonFilter()&&"Open"!==e.isItOpenRightNow()||!1!==m.favoriteButtonFilter()&&!0!==e.isFavorite()},m.scrollToItem=function(){void 0!==m.currentlySelectedLocation()&&!0===m.shouldScroll()&&m.scrolledItem(m.currentlySelectedLocation())},m.makeInfoWindowContent=function(){var e=m.infoWindowHTMLTemplate;return e=$.parseHTML(e)[0]},m.checkIfOnMap=function(e){ko.utils.arrayForEach(m.markedLocations(),function(o){!1===e.contains(o.google_geometry().location)?o.isInViewOnMap(!1):o.isInViewOnMap(!0)})},m.compareIDs=function(e){return ko.utils.arrayFirst(m.markedLocations(),function(o){return o.google_placeId===e})},m.successAPIFunction=function(e,o,t,n,r,a,i){if("basic"===(void 0!==r?"basic":"detailed")){var l=function(e,o,t){void 0===t&&(t="name");for(var n=new FuzzySet([]),r=0,a=e.length;r<a;r++)n.add(e[r][t]);var i=n.get(o);return null!==i&&i[0][0]>appConfigObject.minFuzzyMatch&&n.values().indexOf(i[0][1])}(e,o.google_name());"number"==typeof l?(t(o),m.modelUpdater(o,n,e[l]),e.splice(l,1)):(t(o,"Not Found"),m.failAPIFunction(n.toProperCase()+" Search Problem","No Match Found",void 0,!0));var s={resultsArray:e,locationsArray:r,initialPoint:a,maxDistance:appConfigObject.latLngAccuracy,service:n,minFuzzyMatch:appConfigObject.minFuzzyMatch,workerHandler:i};m.workerHandler(s,n,t)}else t(o),m.modelUpdater(o,n,e)},m.failAPIFunction=function(e,o,t,n){var r,a;switch(void 0===n&&(n=!1),o){case"ZERO_RESULTS":r="No results found from Google. Try zooming out?",a=!0;break;case"OVER_QUERY_LIMIT":r="Requests are being throttled by Google. Usually caused by panning the map too quickly. Give it 10-20 seconds",a=!1;break;default:r=o,a=!1}var i={};i.customMessage=e,i.textStatus=r,i.verbose=n,i.killOnMarkers=a,m.errors(i),t&&console.warn(t)},m.getDetailedAPIData=function(e,o){"None"===o.searchType(e)()?(-1===m.currentDetailedAPIInfoBeingFetched.findID(e,"basic",o)&&m.callBasicAPIData(e,o),m.currentDetailedAPIInfoBeingFetched.interceptIDPush(e,"detailed",o)):"Basic"===o.searchType(e)()&&-1===m.currentDetailedAPIInfoBeingFetched.findID(e,"detailed",o)&&(m.currentDetailedAPIInfoBeingFetched.pushID(e,"detailed",o),m.callAPIInfo("detailed",e,o))},m.callSearchAPIs=function(e){for(var o=ko.toJS(m.locationArrayForWorkers()),t=0,n=m.APIConfiguredSearchTypes.length;t<n;t++){var r=m.APIConfiguredSearchTypes[t];"None"===e.searchType(r)()&&-1===m.currentDetailedAPIInfoBeingFetched.findID(r,"basic",e)&&m.callBasicAPIData(r,e,o)}},m.callBasicAPIData=function(e,o,t){void 0===t&&(t=ko.toJS(m.locationArrayForWorkers())),m.currentDetailedAPIInfoBeingFetched.pushID(e,"basic",o),m.callAPIInfo("basic",e,o,t)},m.checkAndAddFullAttributions=function(e){for(var o=[],t=0,n=e.length;t<n;t++)-1===m.attributionsArray.indexOf(e[t])&&o.push(e[t]);m.attributionsArray.push.apply(m.attributionsArray,o)},m.processNearbyResults=function(e,o,t,n){if(o===google.maps.places.PlacesServiceStatus.OK){for(var r=[],a=0,i=e.length;a<i;a++)if(-1===m.idArray().nearby.indexOf(e[a].place_id)){if(-1===m.idArray().all.indexOf(e[a].place_id)){var l=new c(m,"Nearby");m.successAPIFunction(e[a],l,function(){},"google"),r.push(l)}else{var s=m.compareIDs(e[a].place_id);s&&m.successAPIFunction(e[a],s,m.setAPIResultSearchType("Nearby","google").setSearchType,"google")}0!==e[a].html_attributions.length&&m.checkAndAddFullAttributions(e[a].html_attributions)}m.markedLocations.push.apply(m.markedLocations,r),t&&t.hasNextPage&&setTimeout(function(){!0===m.getRestaurantsFromGoogleMapsAPICallArray[n]&&t.nextPage()},2e3)}else m.failAPIFunction("Google Maps Nearby Search Error",o)},m.processRadarResults=function(e,o){if(o===google.maps.places.PlacesServiceStatus.OK){for(var t=[],n=0,r=e.length;n<r;n++){if(-1===m.idArray().all.indexOf(e[n].place_id)){var a=new c(m,"Radar");m.successAPIFunction(e[n],a,function(){},"google"),t.push(a)}0!==e[n].html_attributions.length&&m.checkAndAddFullAttributions(e[n].html_attributions)}m.markedLocations.push.apply(m.markedLocations,t)}else m.failAPIFunction("Google Maps Radar Search Error",o)},m.getRestaurantsFromGoogleMapsAPI=function(e){var o={bounds:m.mainMap.getBounds(),types:["restaurant"]};m.service.radarSearch(o,m.processRadarResults),m.service.nearbySearch(o,function(o,t,n){m.processNearbyResults(o,t,n,e)})},m.getDetailedGooglePlacesAPIInfo=function(e,o){-1===m.currentDetailedAPIInfoBeingFetched.findID("google","detailed",e)&&(m.currentDetailedAPIInfoBeingFetched.pushID("google","detailed",e),m.service.getDetails({placeId:e.google_placeId},function(t,n){m.currentDetailedAPIInfoBeingFetched.removeID("google","detailed",e),n===google.maps.places.PlacesServiceStatus.OK?(m.successAPIFunction(t,e,m.setAPIResultSearchType("Places","google").setSearchType,"google"),o(e)):m.failAPIFunction("Google Places Search Error",n)}))},m.setAPIResultSearchType=function(e,o){var t={type:e,service:o};return{setSearchType:function(e,o){var n=t.type.toProperCase();o&&(n=o),e.searchType(t.service)(n)}}},m.callAPIInfo=function(e,o,t,n,r){var a,i,l,s=appConfigObject[o+"_searchAPIProperties"],c=s.settings;if(c.url=s[e+"_URL"],"basic"!==e&&(c.url+=t[o+"_id"](),!0===s.extraSlash&&(c.url+="/")),"basic"===e)for(var u in a=t.google_geometry().location.lat(),i=t.google_geometry().location.lng(),l={lat:a,lng:i},s.basicExtraParameters)"function"==typeof s.basicExtraParameters[u]?c.data[u]=s.basicExtraParameters[u](a,i):c.data[u]=s.basicExtraParameters[u];for(var d in s.allExtraParameters)c.data[d]=s.allExtraParameters[d](c.url,c.data);c.success=function(r){var a=r;if("object"==typeof s[e+"_returnType"])for(var i=0,c=s[e+"_returnType"].length;i<c;i++)a=a[s[e+"_returnType"][i]];else a=void 0!==s[e+"_returnType"]?a[s[e+"_returnType"]]:r;void 0!==a?m.successAPIFunction(a,t,m.setAPIResultSearchType(e,o).setSearchType,o,n,l,s.workerHandler):(m.currentDetailedAPIInfoBeingFetched.interceptIDRemove(t),console.debug(r),m.failAPIFunction(o.toProperCase()+" "+e.toProperCase()+" Search Error","Could not interpret results"))},c.error=function(n,r,a){m.currentDetailedAPIInfoBeingFetched.interceptIDRemove(t),m.failAPIFunction(o.toProperCase()+" "+e.toProperCase()+" Search Error",r,a)},c.complete=function(){m.currentDetailedAPIInfoBeingFetched.removeID(o,e,t)},$.ajax(c),"function"==typeof r&&r()},m.getGooglePhotoURL=function(e,o){return"function"==typeof e.getUrl?e.getUrl(o):""},m.avoidMemeoryLeaksDueToEventListeners=function(e){void 0},m.workerHandler=function(e,o,t){if(!0===m.workersAvailable){var n=new Worker("/js/workerFillMarkerData.js");n.onmessage=function(e){for(var r=e.data,a=0,i=r.length;a<i;a++){var l=m.compareIDs(r[a].google_placeId);t(l),m.modelUpdater(l,o,r[a])}m.avoidMemeoryLeaksDueToEventListeners(n)},n.postMessage(e)}},m.getLocalStorage=function(){if(!0===m.storageAvailable){if(localStorage.getItem("favoritesArray")){var e=JSON.parse(localStorage.getItem("favoritesArray"));if(null!==e){for(var o=[],t=0,n=e.length;t<n;t++){var r=new c(m,"Nearby"),a=Number(e[t].google_geometry.location.lat),i=Number(e[t].google_geometry.location.lng),l=new google.maps.LatLng(a,i);m.modelRebuilder(r,e[t],l),r.google_geometry(r.google_geometry()),r.isFavorite(!0),r.google_openingHoursObject(void 0),o.push(r)}m.markedLocations.push.apply(m.markedLocations,o)}}if(localStorage.getItem("mapCenter")){var s=JSON.parse(localStorage.getItem("mapCenter"));null!==s&&void 0!==s.lat&&null!==s.lat&&(m.mapPan(s.lat,s.lng),null!==s.zoom&&"number"==typeof s.zoom&&m.mainMap.setZoom(s.zoom))}}},m.singleErrorMessages=function(){!0!==m.storageAvailable&&m.failAPIFunction("Local Storage Problem","Local Storage support is not available. Favorites will not save after page reload."),!0!==m.workersAvailable&&m.failAPIFunction("Web Workers Problem","Web Workers support is not available. App will function normally but average data retrieval wait times will increase. \n Web workers do not work when loading this application from older browsers or directly from the local file system.")},m.reCheckInfoWindowIsCentered=function(e,o,t){var n=100;!0===m.regularInfoWindowPan()&&(n=600,m.regularInfoWindowPan(!1)),!0!==m.userDrag()&&void 0!==m.currentlySelectedLocation()&&m.currentlySelectedLocation()===o||(n=!1),!1!==n&&(a(e,o,!0,!0,0,t),m.currentInfoWindowCheck=setTimeout(function(){m.reCheckInfoWindowIsCentered(e,o,t)},n))},m.resetFilters=function(){m.searchQuery(""),m.priceButtonFilter(appConfigObject.defaultPriceButtonFilter),m.minRatingButtonFilter(-1),m.openButtonFilter(appConfigObject.defaultOpenButtonFilter),m.favoriteButtonFilter(appConfigObject.defaultFavoriteButtonFilter)},m.initializeCurrentDetailedAPIInfoBeingFetched(),m.singleErrorMessages(),m.getLocalStorage()}ko.bindingHandlers.ko_autocomplete={init:function(e,o){$(e).autocomplete(o())},update:function(e,o,t){$(e).autocomplete({source:function(e,t){t($.ui.autocomplete.filter(o().source,e.term).slice(0,6))},select:function(e,o){t().textInput(o.item.value)}})}},ko.bindingHandlers.textInputForAutocomplete={update:function(e,o){""===ko.unwrap(o())&&$(e).trigger("change")}},ko.bindingHandlers.focusBox={init:function(e){$(e).on("input change autocompletechange",function(){var e=$(this).val(),o=$(this);o.hasClass("search-box-focused")?void 0!==e&&""!==e||o.removeClass("search-box-focused"):void 0!==e&&""!==e&&o.addClass("search-box-focused")})}},ko.bindingHandlers.addressAutocomplete={init:function(e,o,t,n,r){var a=t(),i=r.$data.mainMap,l=o(),s=r.$data.markerCloseClick,c={types:["geocode"]};ko.utils.extend(c,a.autocompleteOptions);var u=new google.maps.places.Autocomplete(e,c);u.bindTo("bounds",i),u.addListener("place_changed",function(){s(),l(!1),$.slidebars.close();var e=u.getPlace();if(e.geometry)if(e.geometry.viewport)i.fitBounds(e.geometry.viewport);else{i.setCenter(e.geometry.location);var o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom;i.setZoom(o)}})},update:function(e,o){ko.bindingHandlers.value.update(e,o())}},ko.bindingHandlers.ko_slideOutMenu={init:function(){$.slidebars()}},ko.bindingHandlers.scrollTo={update:function(e,o){var n=o();ko.unwrap(n)&&t(function(){$(e).scrollintoview({duration:100})},50)()}},ko.bindingHandlers.hoverToggle={init:function(e,o,t,n,r){ko.utils.registerEventHandler(e,"mouseover",function(){r.$data.shouldScroll(!1),$(e).stop(!1,!0)})}},ko.bindingHandlers.ko_slider={init:function(e,o,t,n,r){ko.bindingHandlers.value.init(e,o,t,n,r);var a=o();a.value=o().value(),$(e).slider(a).on("slidechange",function(e,t){o().value(t.value)})}},ko.bindingHandlers.ko_rateit={init:function(e,o){var t=ko.unwrap(o()).observable;$(e).bind("reset",function(){t(0)})},update:function(e,o){-1===ko.unwrap(o()).value&&$(e).rateit("reset")}},ko.bindingHandlers.ko_styleInfoWindow={init:function(e){for(var o,t,n=$(e).parent().parent().addClass("custom-info-window-subcontainer"),r=n.siblings(),a=0,i=r.length;a<i;a++)if("0px"===$(r[a]).css("top")){o=$(r[a]).addClass("custom-info-window-background-container").children();break}if(o){for(var l=0,s=o.length;l<s;l++)if("rgb(255, 255, 255)"===$(o[l]).css("background-color")){t=$(o[l]).addClass("custom-info-window-background").attr("id","custom-info-window-background");break}t&&(n.parent().parent().parent().addClass("custom-info-window"),t.css({"background-color":"","border-radius":""}))}}},ko.bindingHandlers.setResizeListener={update:function(e,o,t,n,r){var a=ko.unwrap(o());if(e.resizeSensor&&(delete e.resizeSensor,delete e.resizedAttached),void 0!==a){var i=$(e),l=$("#custom-info-window-background"),s=0;void 0===l.get(0)&&(l=i,s=50),clearTimeout(r.$data.currentInfoWindowCheck),new ResizeSensor(e,function(){r.$data.regularInfoWindowPan(!0),$(a.infoWindow.content).height($(a.infoWindow.content).height())}),setTimeout(function(){r.$data.reCheckInfoWindowIsCentered(l,a,s)},75)}}},ko.bindingHandlers.ko_bootstrapTooltip={init:function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}},ko.bindingHandlers.ko_perfectScrollbar={init:function(e){$(e).perfectScrollbar(),$(e).bind("mouseenter",function(o){s(0,e)})},update:function(e,o){ko.utils.unwrapObservable(o()),n($(e))}},ko.bindingHandlers.generateStars={update:function(e,o,t,n,r,a){for(var i,l=(i="function"==typeof o?ko.unwrap(o()):o)-Math.floor(i),s="",c=1;c<=i;c++)s+='<span class="glyphicon glyphicon-star" aria-hidden="true"></span>';if(l>0&&(s+='<span class="glyphicon glyphicon-star partial-width-'+Math.round(10*l)+'" aria-hidden="true"></span>'),""!==s){if(!0===a)return s;$(e).html(s)}}},ko.bindingHandlers.obToImg={update:function(e,o,t,n,r,a){var i,l="";if(void 0!==(i="function"==typeof o?ko.unwrap(o()):o)&&(l+='<img src="'+i+'" alt="observable">'),""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.obToLink={update:function(e,o,t,n,r,a){var i,l="";if(void 0!==(i="function"==typeof o?ko.unwrap(o()):o)&&(l+='<a target="_blank" href="'+i+'">'+i+"</a>"),""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.generateUSD={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;for(var l="",s=1;s<=i;s++)l+='<i class="fa fa-usd"></i>';if(""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.ko_modal={init:function(e,o){var t=ko.unwrap(o());ko.utils.registerEventHandler(e,"click",function(){$(t).modal()})}},ko.bindingHandlers.menuToggle={init:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggledObservable;ko.utils.registerEventHandler(e,"click",function(){!function(e,o,t){$(e).toggleClass("mobile-button-pressed");var n=$("#"+o);$(e).trigger("mouseleave"),n.hasClass("panel-visible")?(n.removeClass("panel-visible"),!1!==t()&&t(!1)):(n.addClass("panel-visible"),!0!==t()&&t(!0))}(e,n,r)})},update:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggled;$("#"+n).hasClass("panel-visible")&&!1===r&&$(e).click()}},ko.bindingHandlers.scrollToItem={update:function(e,o,t,n,r){ko.utils.unwrapObservable(o()),r.$data.scrollToItem()}},ko.bindingHandlers.infoWindowTemplate={init:function(e,o,t,n,r){$(e).prev().hasClass("info-window-loaded")||ko.renderTemplate("info-window-template-container",r.$data,{},e,"replaceNode")}},ko.bindingHandlers.errorsHandler={update:function(e,o,t,n,r){var a=o().data();if(!1!==a){o().data(!1);var s=o().verbose(),c=a.verbose;if(!0===s||!1===c){var u=a.killOnMarkers,d='<div class="panel ';d+=!0===c?"panel-warning":"panel-danger",d+='"><div class="panel-heading"><h3 class="panel-title">',d+=a.customMessage,d+='</h3></div><div class="panel-body">',d+=a.textStatus,d+="</div></div>",$("#error-container").append(d);var g=$("#error-container").children().last();g.show(200),g.bind("click",l),!0===c&&setTimeout(function(){i(g,200)},3e3),!0===u&&$.doWhen({when:function(){return r.$data.listableEntries().entries.length>0}}).done(function(){i(g,200)})}}}},ko.bindingHandlers.listOutOpeningHours={update:function(o,t){var n=ko.unwrap(t());if(void 0!==n&&!1!==e(n,"weekday_text","0")){for(var r="",a=0,i=n.weekday_text.length;a<i;a++)r+="<div>"+n.weekday_text[a]+"</div>";o.innerHTML=r}}},ko.bindingHandlers.dropdown={init:function(e){$(e).on("shown.bs.dropdown",function(){var e=$(this).find(".dropdown-menu");if(null!==e&&1===e.length){var o=e.parent(),t=$("#info-window-template");e.position({of:o,my:"left top",at:"left bottom",collision:"flip",within:t})}})},update:function(e,o,t,n,a){var i=o().data,l='<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret caret-dropdown"></span></button><ul class="dropdown-menu dropdown-menu-right">',s=l;for(var c in i){var u;if(!1!==(u=void 0!==i[c].value_binding?r(i[c].value,i[c].value_binding,e,t,n,a):r(i[c].value))){if(s+="<li><strong>"+c+":</strong> <span>"+u+"</span>",void 0!==i[c].value_binding_show_text&&(s+=" ("+r(i[c].value)+")"),void 0!==i[c].value_2)if(void 0!==i[c].value_3)for(var d=2;void 0!==i[c]["value_"+d];){var g=r(i[c]["value_"+d]);!1!==g&&(s+=2===d?"("+g+")":", "+g,void 0===i[c]["value_"+(d+1).toString()]&&void 0!==i[c].append&&(s+=i[c].append)),d++}else{var p=r(i[c].value_2);!1!==p&&(s+=", "+p,void 0!==i[c].append&&(s+=i[c].append))}s+="</li>"}}s!==l&&(s+="</ul>",e.innerHTML=s),$(e).hasClass("open")&&$(e).trigger("shown.bs.dropdown")}},ko.extenders.numeric=function(e,o){return ko.computed({read:function(){return Number(e()).toFixed(o)/1},write:e})};var d=!1,g=!1,p=!1;function f(){alert("Google Maps failed to load. Please try again later.")}return{googleLoaded:function(){p=!0},googleFailedToLoad:f,preloadFontsAndImages:function(){var e={google:{families:["Lato:400,400italic,700:latin","Scheherazade:400,700:latin"]},timeout:1e4,active:function(){g=!0},inactive:function(){g=!0,console.warn("Fonts were not loaded.")}};WebFont.load(e),function(e,o){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=new Image,t[n].src=e[n];"function"==typeof o&&o()}(["img/marker-1.png","img/marker-2.png","img/marker-3.png","img/marker-4.png","img/marker-empty.png","img/marker-heart.png"],function(){d=!0}),$.doWhen({when:function(){return!0===d&&!0===g&&!0===p}}).done(function(){!function(){if("undefined"==typeof google)f();else{var e=new google.maps.LatLng(appConfigObject.defaultLat,appConfigObject.defaultLng),o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom,n=document.getElementById("mapDiv"),r=appConfigObject.mapStyle,a={center:e,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{mapTypeIds:[]},styles:r},i=new google.maps.MarkerImage("img/reticle.png",new google.maps.Size(16,16),new google.maps.Point(0,0),new google.maps.Point(8,8)),l=new google.maps.Map(n,a),s=new u(l);ko.applyBindings(s,document.body);var c=new google.maps.Marker({position:l.getCenter(),map:l,icon:i,shape:{coords:[8,8,8,8],type:"rect"},optimized:!1,zIndex:5}),d=t(function(e){c.setPosition(e)},16,{leading:!1}),g=t(function(){void 0!==s.getRestaurantsFromGoogleMapsAPICallArray[s.getRestaurantsFromGoogleMapsAPICallArray.length-1]&&(s.getRestaurantsFromGoogleMapsAPICallArray[s.getRestaurantsFromGoogleMapsAPICallArray.length-1]=!1),s.getRestaurantsFromGoogleMapsAPICallArray.push(!0),s.getRestaurantsFromGoogleMapsAPI(s.getRestaurantsFromGoogleMapsAPICallArray.length-1)},1200,{trailing:!1}),p=t(function(e){s.checkIfOnMap(s.mainMap.getBounds()),s.mainMapCenter(e),g()},50,{leading:!1});if(google.maps.event.addListener(l,"bounds_changed",function(){var e=l.getCenter();p(e),d(e)}),google.maps.event.addListener(l,"dragstart",function(){s.userDrag(!0)}),!0===s.storageAvailable){var m=JSON.parse(localStorage.getItem("mapCenter"));localStorage.getItem("mapCenter")&&void 0!==m.lat&&null!==m.lat||s.getNavWithCallback()}else s.getNavWithCallback()}}(),$("#loading").fadeOut(500)})}}}();