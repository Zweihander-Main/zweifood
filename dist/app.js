var app=function(){"use strict";function u(e){for(var o=Array.prototype.slice.call(arguments,1),t=0,n=o.length;t<n;t++){if(!e||!e.hasOwnProperty(o[t]))return!1;e=e[o[t]]}return!0}String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var d=Date.now||function(){return(new Date).getTime()};function p(t,n,r){var a,i,l,s=null,c=0;r||(r={});var u=function(){c=!1===r.leading?0:d(),s=null,l=t.apply(a,i),s||(a=i=null)};return function(){var e=d();c||!1!==r.leading||(c=e);var o=n-(e-c);return a=this,i=arguments,o<=0||n<o?(s&&(clearTimeout(s),s=null),c=e,l=t.apply(a,i),s||(a=i=null)):s||!1===r.trailing||(s=setTimeout(u,o)),l}}var t=p(function(e){e.perfectScrollbar("update")},16,{leading:!1});function f(e,o,t,n,r,a){if(null==e)return!1;if(e.constructor===Array){if(void 0===e[0])return!1;if(!0!==u.apply(void 0,e))return!1;for(var i=e[0],l=1,s=e.length;l<s;l++)i=i[e[l]];e=i}return void 0!==o&&(e=ko.bindingHandlers[o].update(t,e,n,r,a,!0)),e}function m(c,u,d,g,e,p){setTimeout(function(){var e,o,t,n,r,a,i=0,l=0;if(!0===d){var s=$("#marker-list");(1199<window.innerWidth||!0===s.hasClass("panel-visible"))&&s.width()+s.offset().left+c.width()+p+20<window.innerWidth&&c.offset().left<s.width()+s.offset().left+10&&(i=s.width()+s.offset().left-c.offset().left+10)}!0===g&&c.offset().top<0&&(l=c.offset().top-15),0===i&&0===l||(e=u.marker().map,o=void 0,t=i,n=l,r=e.getProjection().fromLatLngToPoint(o instanceof google.maps.LatLng?o:e.getCenter()),a=new google.maps.Point(("number"==typeof t?t:0)/Math.pow(2,e.getZoom())||0,("number"==typeof n?n:0)/Math.pow(2,e.getZoom())||0),e.setCenter(e.getProjection().fromPointToLatLng(new google.maps.Point(r.x-a.x,r.y+a.y))))},void 0!==e?e:0)}function g(e,o){e.hide(o,function(){e.unbind("click",v),e.remove()})}function v(e){g($(e.currentTarget),50)}function n(e,o){t($(o)),$(o).unbind("mouseenter",n)}function b(n,e){var r=this;r.googleSearchType=ko.observable(e),r.googleIsLoading=ko.observable(!1),r.isInViewOnMap=ko.observable(!0),r.isListed=ko.observable(!1),r.isSelected=ko.observable(!1),r.hasBeenOpened=!1,r.modelNumber=n.getLocationModelNumber(),r.isFavorite=ko.observable(!1),r.disposableArray=[],r.listenerStorage=[],n.modelConstructor(r),n.modelSearchTypeConstructor(r),r.marker=ko.observable(new google.maps.Marker({map:n.mainMap,opacity:!1===r.isListed()?n.lowMarkerOpacity():appConfigObject.highMarkerOpacity,icon:n.markerImageCreator(),shape:appConfigObject.defaultMarkerShape})),r.disposableArray.push(r.isFavorite.subscribe(function(e){r.marker().setIcon(n.markerImageCreator(e,r.google_priceLevel())),r.marker(r.marker()),n.changeFavoriteArray(e,r)})),r.disposableArray.push(r.isSelected.subscribe(function(e){n.changeCurrentlySelectedItem(e,r)})),r.disposableArray.push(r.isListed.subscribe(function(e){e?r.marker().setOpacity(appConfigObject.highMarkerOpacity):r.marker().setOpacity(n.lowMarkerOpacity()),r.marker(r.marker())})),r.disposableArray.push(r.google_priceLevel.subscribe(function(e){r.marker().setIcon(n.markerImageCreator(r.isFavorite(),e)),r.marker(r.marker())})),r.disposableArray.push(r.google_name.subscribe(function(e){r.marker().setTitle(e),r.marker(r.marker())})),r.disposableArray.push(r.google_geometry.subscribe(function(e){r.marker().setPosition(e.location),r.marker(r.marker())})),r.isItOpenRightNow=ko.pureComputed(function(){if(void 0!==r.google_openingHoursObject()){if(!0===r.google_openingHoursObject().open_now)return"Open";if(!1===r.google_openingHoursObject().open_now)return"Closed"}}),r.infoWindow=new google.maps.InfoWindow({content:n.makeInfoWindowContent()}),r.listenerStorage.push(r.infoWindow.addListener("closeclick",n.markerCloseClick)),r.listenerStorage.push(r.infoWindow.addListener("domready",n.markerDomReady)),r.listenerStorage.push(r.marker().addListener("click",function(){n.markerClick(r)})),r.listWasClicked=function(e,o,t){new google.maps.event.trigger(r.marker(),"click"),r.marker().map.panTo(r.google_geometry().location),t<1200&&n.markerToggled(!1)},r.searchType=function(e){return r[e.toLowerCase()+"SearchType"]},r.dispose=function(){r.marker().setMap(null),ko.utils.arrayForEach(r.disposableArray,function(e){e.dispose()}),ko.utils.arrayForEach(r.listenerStorage,function(e){google.maps.event.removeListener(e)})}}function h(e){var o,t,n,r,a,i,l,s,c,g=this;g.mainMap=e,g.mainMapCenter=ko.observable(),g.service=new google.maps.places.PlacesService(g.mainMap),g.storageAvailable=function(e){try{var o=window[e],t="__storage_test__";return o.setItem(t,t),o.removeItem(t),!0}catch(e){return!1}}("localStorage"),g.workersAvailable="undefined"!=typeof Worker&&"file:"!==window.location.protocol,g.maxMarkerLimit=ko.observable(appConfigObject.maxMarkerLimit),g.lowMarkerOpacity=ko.observable(appConfigObject.lowMarkerOpacity),g.APIMappingsForModel=appConfigObject.APIMappingsForModel,g.APIConfiguredSearchTypes=appConfigObject.configuredSearchTypes,g.defaultMarkerImage={size:new google.maps.Size(appConfigObject.markerImageSize[0],appConfigObject.markerImageSize[1]),origin:new google.maps.Point(appConfigObject.markerImageOrigin[0],appConfigObject.markerImageOrigin[1]),anchor:new google.maps.Point(appConfigObject.markerImageAnchor[0],appConfigObject.markerImageAnchor[1])},g.markedLocations=ko.observableArray([]),g.locationModelNumber=0,g.currentlySelectedLocation=ko.observable(),g.scrolledItem=ko.observable(),g.shouldScroll=ko.observable(!1),g.attributionsArray=ko.observableArray([]),g.favoriteArray=ko.observableArray([]),g.getRestaurantsFromGoogleMapsAPICallArray=[],g.currentDetailedAPIInfoBeingFetched={},g.errors=ko.observable(!1),g.verboseErrors=ko.observable(!1),g.checkNested=u,g.markerToggled=ko.observable(!1),g.optionsToggled=ko.observable(!1),g.regularInfoWindowPan=ko.observable(!1),g.userDrag=ko.observable(!1),g.currentInfoWindowCheck=void 0,g.sortType=ko.observable("count"),g.searchQuery=ko.observable(),g.priceButtonFilter=ko.observableArray(appConfigObject.defaultPriceButtonFilter),g.minRatingButtonFilter=ko.observable(appConfigObject.defaultMinRatingButtonFilter),g.openButtonFilter=ko.observable(appConfigObject.defaultOpenButtonFilter),g.favoriteButtonFilter=ko.observable(appConfigObject.defaultFavoriteButtonFilter),g.infoWindowHTMLTemplate='<div class = "info-window-template" data-bind = "infoWindowTemplate: true"></div>',g.lowMarkerOpacity.subscribe(function(o){o=Number(o).toFixed(2)/1,ko.utils.arrayForEach(g.markedLocations(),function(e){!1===e.isListed()&&e.marker().setOpacity(o)})}),g.lowMarkerOpacity.extend({numeric:2}),g.mainMapCenter.subscribe(function(e){g.setLocalStorage("mapCenter",JSON.stringify({lat:e.lat(),lng:e.lng(),zoom:g.mainMap.getZoom()}))}),g.markedLocations.subscribe(function(e){e.length>g.maxMarkerLimit()&&g.removeMultipleLocations(e)}),g.favoriteArray.subscribe(function(e){var o=[];ko.utils.arrayForEach(e,function(e){o.push(g.modelDeconstructor(e))});var t=JSON.stringify(o);0!==o.length?g.setLocalStorage("favoritesArray",t):g.setLocalStorage("favoritesArray","[]")}),g.favoriteArray.extend({rateLimit:2e3}),g.currentlySelectedLocation.subscribe((o=function(e){void 0!==e&&(g.scrollToItem(),g.userDrag(!1))},t=5,c=function(){var e=d()-l;e<t&&0<=e?r=setTimeout(c,t-e):(r=null,n||(s=o.apply(i,a),r||(i=a=null)))},function(){i=this,a=arguments,l=d();var e=n&&!r;return r||(r=setTimeout(c,t)),e&&(s=o.apply(i,a),i=a=null),s})),g.idArray=ko.pureComputed(function(){var o={all:[],nearby:[]};return ko.utils.arrayMap(g.markedLocations(),function(e){"Nearby"!==e.googleSearchType()&&"Places"!==e.googleSearchType()||o.nearby.push(e.google_placeId),o.all.push(e.google_placeId)}),o}),g.priceButtonFilterHasChanged=ko.pureComputed(function(){return!function(e,o){for(var t=0,n=e.length;t<n;t++)if(e[t]!==o[t])return!1;return!0}(g.priceButtonFilter(),[!0,!0,!0,!0,!0])}),g.listableEntries=ko.computed(function(){var o={entries:[],allNames:[]};return o.entries=ko.utils.arrayFilter(g.markedLocations(),function(e){return"Nearby"!==e.googleSearchType()&&"Places"!==e.googleSearchType()||!0!==e.isInViewOnMap()||!1!==g.isSearchFiltered(e)||!1!==g.isButtonFiltered(e)?(e.isListed(!1),!1):(e.isListed(!0),o.allNames.push(e.google_name()),!0)}),o}),g.sortedEntries=ko.pureComputed(function(){var e=g.listableEntries().entries;return"count"===g.sortType()?e.sort(function(e,o){return e.modelNumber<o.modelNumber?-1:1}):"alpha"===g.sortType()?e.sort(function(e,o){return e.google_name()===o.google_name()?0:e.google_name()<o.google_name()?-1:1}):"rating"===g.sortType()?e.sort(function(e,o){return void 0===e.google_rating()?void 0===o.google_rating()?0:1:void 0===o.google_rating()?-1:e.google_rating()<o.google_rating()?1:-1}):"distance"===g.sortType()&&e.sort(function(e,o){var t=e.google_geometry().location.lat(),n=o.google_geometry().location.lat(),r=g.mainMapCenter().lat(),a=e.google_geometry().location.lng(),i=o.google_geometry().location.lng(),l=g.mainMapCenter().lng(),s=appConfigObject.distanceBetweenTwoPointsInMeters(t,a,r,l),c=appConfigObject.distanceBetweenTwoPointsInMeters(n,i,r,l);return s===c?0:s<c?-1:1}),e}),g.listableEntries.extend({rateLimit:50}),g.initializeCurrentDetailedAPIInfoBeingFetched=function(){g.currentDetailedAPIInfoBeingFetched.findID=function(e,o,t){return this[e][o].indexOf(t)},g.currentDetailedAPIInfoBeingFetched.pushID=function(e,o,t){this[e][o].push(t),this[e][o][this[e][o].length-1][e+"IsLoading"](!0)},g.currentDetailedAPIInfoBeingFetched.removeID=function(e,o,t){var n=this.findID(e,o,t);-1<n&&(this[e][o][n][e+"IsLoading"](!1),this[e][o].splice(n,1));for(var r=0,a=this.intercept.length;r<a;r++)this.intercept[r].ID===t&&(g.getDetailedAPIData(this.intercept[r].service,this.intercept[r].ID),this.intercept.splice(r,1))},g.currentDetailedAPIInfoBeingFetched.intercept=[],g.currentDetailedAPIInfoBeingFetched.interceptIDPush=function(e,o,t){for(var n=0,r=this.intercept.length;n<r;n++)if(this.intercept.ID===t)return;this.intercept.push({ID:t,type:o,service:e})},g.currentDetailedAPIInfoBeingFetched.interceptIDRemove=function(e){for(var o=0,t=this.intercept.length;o<t;o++)this.intercept.ID===e&&this.intercept.splice(o,1)};for(var e=0,o=g.APIConfiguredSearchTypes.length;e<o;e++)g.currentDetailedAPIInfoBeingFetched[g.APIConfiguredSearchTypes[e]]={basic:[],detailed:[]};g.currentDetailedAPIInfoBeingFetched.google={detailed:[]}},g.changeCurrentlySelectedItem=function(e,o){!0===e?g.currentlySelectedLocation(o):g.currentlySelectedLocation(void 0)},g.changeFavoriteArray=function(e,o){!0===e?g.favoriteArray.push(o):g.favoriteArray.remove(o)},g.markerCloseClick=function(){void 0!==g.currentlySelectedLocation()&&(g.currentlySelectedLocation().hasBeenOpened=!1,g.currentlySelectedLocation().isSelected(!1))},g.markerDomReady=function(){g.currentlySelectedLocation().hasBeenOpened||(ko.applyBindings(g,g.currentlySelectedLocation().infoWindow.getContent()),g.currentlySelectedLocation().hasBeenOpened=!0)},g.markerClick=function(e){!0===e.hasBeenOpened&&(e.hasBeenOpened=!1),g.shouldScroll(!0),g.getDetailedGooglePlacesAPIInfo(e,g.callSearchAPIs),void 0!==g.currentlySelectedLocation()&&(g.currentlySelectedLocation().infoWindow.close(),g.currentlySelectedLocation().isSelected(!1)),e.isSelected(!0),g.markerAnimation(e),e.infoWindow.open(e.marker().map,e.marker())},g.markerAnimation=function(e){e.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker().setAnimation(null)},750)},g.markerImageCreator=function(e,o){var t=g.defaultMarkerImage;if(!0===e)return t.url=appConfigObject.markerImageURLFav,t;switch(o){case 1:return t.url=appConfigObject.markerImageURL1,t;case 2:return t.url=appConfigObject.markerImageURL2,t;case 3:return t.url=appConfigObject.markerImageURL3,t;case 4:return t.url=appConfigObject.markerImageURL4,t;default:return t.url=appConfigObject.markerImageURLEmpty,t}},g.getNavWithCallback=function(){return!!navigator.geolocation&&navigator.geolocation.getCurrentPosition(g.mapPanFromNavigation)},g.mapPanFromNavigation=function(e){g.mapPan(e.coords.latitude,e.coords.longitude),g.markerCloseClick(),g.optionsToggled(!1)},g.mapPan=function(e,o){var t=new google.maps.LatLng(e,o);g.mainMap.panTo(t)},g.modelConstructor=function(e){for(var o in g.APIMappingsForModel)for(var t=g.APIMappingsForModel[o],n=0,r=t.length;n<r;n++)1===t[n].oType?e[t[n].model]=ko.observable():2===t[n].oType&&(e[t[n].model]=ko.observableArray([]))},g.modelDeconstructor=function(e){var o={};for(var t in g.APIMappingsForModel)for(var n=g.APIMappingsForModel[t],r=0,a=n.length;r<a;r++)0===n[r].oType?o[n[r].model]=e[n[r].model]:o[n[r].model]=e[n[r].model]();return o},g.modelUpdater=function(e,o,t){for(var n=g.APIMappingsForModel[o],r=0,a=n.length;r<a;r++)void 0!==t[n[r].server]&&(0!==n[r].oType?e[n[r].model](t[n[r].server]):e[n[r].model]=t[n[r].server])},g.modelRebuilder=function(e,o,t){for(var n in g.APIMappingsForModel)for(var r=g.APIMappingsForModel[n],a=0,i=r.length;a<i;a++)if(0!==r[a].oType&&"google_geometry"!==r[a].model)e[r[a].model](o[r[a].model]);else if("google_geometry"===r[a].model){var l=o[r[a].model];l.location=t,e[r[a].model](l)}else e[r[a].model]=o[r[a].model]},g.modelSearchTypeConstructor=function(e){for(var o=0,t=g.APIConfiguredSearchTypes.length;o<t;o++)e[g.APIConfiguredSearchTypes[o].toLowerCase()+"SearchType"]=ko.observable("None"),e[g.APIConfiguredSearchTypes[o].toLowerCase()+"IsLoading"]=ko.observable(!1)},g.removeMultipleLocations=p(function(e){g.markedLocations.sort(function(e,o){return!0===e.isFavorite()?1:e.modelNumber<o.modelNumber?-1:1});for(var o=0;o<appConfigObject.markerLimitRemoveBulkAmount;o++)e[o].dispose();g.markedLocations.splice(0,appConfigObject.markerLimitRemoveBulkAmount)},1e3,{trailing:!1}),g.getLocationModelNumber=function(){return g.locationModelNumber++,g.locationModelNumber-1},g.setLocalStorage=p(function(e,o){!0===g.storageAvailable&&localStorage.setItem(e,o)},1e3,{trailing:!1}),g.locationArrayForWorkers=function(){return ko.utils.arrayMap(g.listableEntries().entries,function(e){return{lat:e.google_geometry().location.lat(),lng:e.google_geometry().location.lng(),name:e.google_name(),google_placeId:e.google_placeId}})},g.isSearchFiltered=function(e){return void 0!==g.searchQuery()&&!(0<=e.google_name().toLowerCase().indexOf(g.searchQuery().toLowerCase()))},g.isButtonFiltered=function(e){if(!0===g.priceButtonFilterHasChanged())if(void 0!==e.google_priceLevel()){for(var o=0;o<5;o++)if(!0!==g.priceButtonFilter()[o]&&e.google_priceLevel()===o)return!0}else if(!0!==g.priceButtonFilter()[0])return!0;if(0!==g.minRatingButtonFilter()){if(void 0===e.google_rating())return!0;if(e.google_rating()<g.minRatingButtonFilter())return!0}return!1!==g.openButtonFilter()&&"Open"!==e.isItOpenRightNow()||!1!==g.favoriteButtonFilter()&&!0!==e.isFavorite()},g.scrollToItem=function(){void 0!==g.currentlySelectedLocation()&&!0===g.shouldScroll()&&g.scrolledItem(g.currentlySelectedLocation())},g.makeInfoWindowContent=function(){var e=g.infoWindowHTMLTemplate;return e=$.parseHTML(e)[0]},g.checkIfOnMap=function(o){ko.utils.arrayForEach(g.markedLocations(),function(e){!1===o.contains(e.google_geometry().location)?e.isInViewOnMap(!1):e.isInViewOnMap(!0)})},g.compareIDs=function(o){return ko.utils.arrayFirst(g.markedLocations(),function(e){return e.google_placeId===o})},g.successAPIFunction=function(e,o,t,n,r,a,i){if("basic"===(void 0!==r?"basic":"detailed")){var l=function(e,o,t){void 0===t&&(t="name");for(var n=new FuzzySet([]),r=0,a=e.length;r<a;r++)n.add(e[r][t]);var i=n.get(o);return null!==i&&i[0][0]>appConfigObject.minFuzzyMatch&&n.values().indexOf(i[0][1])}(e,o.google_name());"number"==typeof l?(t(o),g.modelUpdater(o,n,e[l]),e.splice(l,1)):(t(o,"Not Found"),g.failAPIFunction(n.toProperCase()+" Search Problem","No Match Found",void 0,!0));var s={resultsArray:e,locationsArray:r,initialPoint:a,maxDistance:appConfigObject.latLngAccuracy,service:n,minFuzzyMatch:appConfigObject.minFuzzyMatch,workerHandler:i};g.workerHandler(s,n,t)}else t(o),g.modelUpdater(o,n,e)},g.failAPIFunction=function(e,o,t,n){var r,a;switch(void 0===n&&(n=!1),o){case"ZERO_RESULTS":r="No results found from Google. Try zooming out?",a=!0;break;case"OVER_QUERY_LIMIT":a=!(r="Requests are being throttled by Google. Usually caused by panning the map too quickly. Give it 10-20 seconds");break;default:r=o,a=!1}var i={};i.customMessage=e,i.textStatus=r,i.verbose=n,i.killOnMarkers=a,g.errors(i),t&&console.warn(t)},g.getDetailedAPIData=function(e,o){"None"===o.searchType(e)()?(-1===g.currentDetailedAPIInfoBeingFetched.findID(e,"basic",o)&&g.callBasicAPIData(e,o),g.currentDetailedAPIInfoBeingFetched.interceptIDPush(e,"detailed",o)):"Basic"===o.searchType(e)()&&-1===g.currentDetailedAPIInfoBeingFetched.findID(e,"detailed",o)&&(g.currentDetailedAPIInfoBeingFetched.pushID(e,"detailed",o),g.callAPIInfo("detailed",e,o))},g.callSearchAPIs=function(e){for(var o=ko.toJS(g.locationArrayForWorkers()),t=0,n=g.APIConfiguredSearchTypes.length;t<n;t++){var r=g.APIConfiguredSearchTypes[t];"None"===e.searchType(r)()&&-1===g.currentDetailedAPIInfoBeingFetched.findID(r,"basic",e)&&g.callBasicAPIData(r,e,o)}},g.callBasicAPIData=function(e,o,t){void 0===t&&(t=ko.toJS(g.locationArrayForWorkers())),g.currentDetailedAPIInfoBeingFetched.pushID(e,"basic",o),g.callAPIInfo("basic",e,o,t)},g.checkAndAddFullAttributions=function(e){for(var o=[],t=0,n=e.length;t<n;t++)-1===g.attributionsArray.indexOf(e[t])&&o.push(e[t]);g.attributionsArray.push.apply(g.attributionsArray,o)},g.processNearbyResults=function(e,o,t,n){if(o===google.maps.places.PlacesServiceStatus.OK){for(var r=[],a=0,i=e.length;a<i;a++)if(-1===g.idArray().nearby.indexOf(e[a].place_id)){if(-1===g.idArray().all.indexOf(e[a].place_id)){var l=new b(g,"Nearby");g.successAPIFunction(e[a],l,function(){},"google"),r.push(l)}else{var s=g.compareIDs(e[a].place_id);s&&g.successAPIFunction(e[a],s,g.setAPIResultSearchType("Nearby","google").setSearchType,"google")}0!==e[a].html_attributions.length&&g.checkAndAddFullAttributions(e[a].html_attributions)}g.markedLocations.push.apply(g.markedLocations,r),t&&t.hasNextPage&&setTimeout(function(){!0===g.getRestaurantsFromGoogleMapsAPICallArray[n]&&t.nextPage()},2e3)}else g.failAPIFunction("Google Maps Nearby Search Error",o)},g.processRadarResults=function(e,o){if(o===google.maps.places.PlacesServiceStatus.OK){for(var t=[],n=0,r=e.length;n<r;n++){if(-1===g.idArray().all.indexOf(e[n].place_id)){var a=new b(g,"Radar");g.successAPIFunction(e[n],a,function(){},"google"),t.push(a)}0!==e[n].html_attributions.length&&g.checkAndAddFullAttributions(e[n].html_attributions)}g.markedLocations.push.apply(g.markedLocations,t)}else g.failAPIFunction("Google Maps Radar Search Error",o)},g.getRestaurantsFromGoogleMapsAPI=function(n){var e={bounds:g.mainMap.getBounds(),types:["restaurant"]};g.service.radarSearch(e,g.processRadarResults),g.service.nearbySearch(e,function(e,o,t){g.processNearbyResults(e,o,t,n)})},g.getDetailedGooglePlacesAPIInfo=function(t,n){-1===g.currentDetailedAPIInfoBeingFetched.findID("google","detailed",t)&&(g.currentDetailedAPIInfoBeingFetched.pushID("google","detailed",t),g.service.getDetails({placeId:t.google_placeId},function(e,o){g.currentDetailedAPIInfoBeingFetched.removeID("google","detailed",t),o===google.maps.places.PlacesServiceStatus.OK?(g.successAPIFunction(e,t,g.setAPIResultSearchType("Places","google").setSearchType,"google"),n(t)):g.failAPIFunction("Google Places Search Error",o)}))},g.setAPIResultSearchType=function(e,o){var n={type:e,service:o};return{setSearchType:function(e,o){var t=n.type.toProperCase();o&&(t=o),e.searchType(n.service)(t)}}},g.callAPIInfo=function(r,a,i,l,e){var o,t,s,c=appConfigObject[a+"_searchAPIProperties"],n=c.settings;if(n.url=c[r+"_URL"],"basic"!==r&&(n.url+=i[a+"_id"](),!0===c.extraSlash&&(n.url+="/")),"basic"===r)for(var u in o=i.google_geometry().location.lat(),t=i.google_geometry().location.lng(),s={lat:o,lng:t},c.basicExtraParameters)"function"==typeof c.basicExtraParameters[u]?n.data[u]=c.basicExtraParameters[u](o,t):n.data[u]=c.basicExtraParameters[u];for(var d in c.allExtraParameters)n.data[d]=c.allExtraParameters[d](n.url,n.data);n.success=function(e){var o=e;if("object"==typeof c[r+"_returnType"])for(var t=0,n=c[r+"_returnType"].length;t<n;t++)o=o[c[r+"_returnType"][t]];else o=void 0!==c[r+"_returnType"]?o[c[r+"_returnType"]]:e;void 0!==o?g.successAPIFunction(o,i,g.setAPIResultSearchType(r,a).setSearchType,a,l,s,c.workerHandler):(g.currentDetailedAPIInfoBeingFetched.interceptIDRemove(i),console.debug(e),g.failAPIFunction(a.toProperCase()+" "+r.toProperCase()+" Search Error","Could not interpret results"))},n.error=function(e,o,t){g.currentDetailedAPIInfoBeingFetched.interceptIDRemove(i),g.failAPIFunction(a.toProperCase()+" "+r.toProperCase()+" Search Error",o,t)},n.complete=function(){g.currentDetailedAPIInfoBeingFetched.removeID(a,r,i)},$.ajax(n),"function"==typeof e&&e()},g.getGooglePhotoURL=function(e,o){return"function"==typeof e.getUrl?e.getUrl(o):""},g.avoidMemeoryLeaksDueToEventListeners=function(e){void 0},g.workerHandler=function(e,a,i){if(!0===g.workersAvailable){var l=new Worker("/js/workerFillMarkerData.js");l.onmessage=function(e){for(var o=e.data,t=0,n=o.length;t<n;t++){var r=g.compareIDs(o[t].google_placeId);i(r),g.modelUpdater(r,a,o[t])}g.avoidMemeoryLeaksDueToEventListeners(l)},l.postMessage(e)}},g.getLocalStorage=function(){if(!0===g.storageAvailable){if(localStorage.getItem("favoritesArray")){var e=JSON.parse(localStorage.getItem("favoritesArray"));if(null!==e){for(var o=[],t=0,n=e.length;t<n;t++){var r=new b(g,"Nearby"),a=Number(e[t].google_geometry.location.lat),i=Number(e[t].google_geometry.location.lng),l=new google.maps.LatLng(a,i);g.modelRebuilder(r,e[t],l),r.google_geometry(r.google_geometry()),r.isFavorite(!0),r.google_openingHoursObject(void 0),o.push(r)}g.markedLocations.push.apply(g.markedLocations,o)}}if(localStorage.getItem("mapCenter")){var s=JSON.parse(localStorage.getItem("mapCenter"));null!==s&&void 0!==s.lat&&null!==s.lat&&(g.mapPan(s.lat,s.lng),null!==s.zoom&&"number"==typeof s.zoom&&g.mainMap.setZoom(s.zoom))}}},g.singleErrorMessages=function(){!0!==g.storageAvailable&&g.failAPIFunction("Local Storage Problem","Local Storage support is not available. Favorites will not save after page reload."),!0!==g.workersAvailable&&g.failAPIFunction("Web Workers Problem","Web Workers support is not available. App will function normally but average data retrieval wait times will increase. \n Web workers do not work when loading this application from older browsers or directly from the local file system.")},g.reCheckInfoWindowIsCentered=function(e,o,t){var n=100;!0===g.regularInfoWindowPan()&&(n=600,g.regularInfoWindowPan(!1)),!0!==g.userDrag()&&void 0!==g.currentlySelectedLocation()&&g.currentlySelectedLocation()===o||(n=!1),!1!==n&&(m(e,o,!0,!0,0,t),g.currentInfoWindowCheck=setTimeout(function(){g.reCheckInfoWindowIsCentered(e,o,t)},n))},g.resetFilters=function(){g.searchQuery(""),g.priceButtonFilter(appConfigObject.defaultPriceButtonFilter),g.minRatingButtonFilter(-1),g.openButtonFilter(appConfigObject.defaultOpenButtonFilter),g.favoriteButtonFilter(appConfigObject.defaultFavoriteButtonFilter)},g.initializeCurrentDetailedAPIInfoBeingFetched(),g.singleErrorMessages(),g.getLocalStorage()}ko.bindingHandlers.ko_autocomplete={init:function(e,o){$(e).autocomplete(o())},update:function(e,t,n){$(e).autocomplete({source:function(e,o){o($.ui.autocomplete.filter(t().source,e.term).slice(0,6))},select:function(e,o){n().textInput(o.item.value)}})}},ko.bindingHandlers.textInputForAutocomplete={update:function(e,o){""===ko.unwrap(o())&&$(e).trigger("change")}},ko.bindingHandlers.focusBox={init:function(e){$(e).on("input change autocompletechange",function(){var e=$(this).val(),o=$(this);o.hasClass("search-box-focused")?void 0!==e&&""!==e||o.removeClass("search-box-focused"):void 0!==e&&""!==e&&o.addClass("search-box-focused")})}},ko.bindingHandlers.addressAutocomplete={init:function(e,o,t,n,r){var a=t(),i=r.$data.mainMap,l=o(),s=r.$data.markerCloseClick,c={types:["geocode"]};ko.utils.extend(c,a.autocompleteOptions);var u=new google.maps.places.Autocomplete(e,c);u.bindTo("bounds",i),u.addListener("place_changed",function(){s(),l(!1),$.slidebars.close();var e=u.getPlace();if(e.geometry)if(e.geometry.viewport)i.fitBounds(e.geometry.viewport);else{i.setCenter(e.geometry.location);var o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom;i.setZoom(o)}})},update:function(e,o){ko.bindingHandlers.value.update(e,o())}},ko.bindingHandlers.ko_slideOutMenu={init:function(){$.slidebars()}},ko.bindingHandlers.scrollTo={update:function(e,o){var t=o();ko.unwrap(t)&&p(function(){$(e).scrollintoview({duration:100})},50)()}},ko.bindingHandlers.hoverToggle={init:function(e,o,t,n,r){ko.utils.registerEventHandler(e,"mouseover",function(){r.$data.shouldScroll(!1),$(e).stop(!1,!0)})}},ko.bindingHandlers.ko_slider={init:function(e,t,o,n,r){ko.bindingHandlers.value.init(e,t,o,n,r);var a=t();a.value=t().value(),$(e).slider(a).on("slidechange",function(e,o){t().value(o.value)})}},ko.bindingHandlers.ko_rateit={init:function(e,o){var t=ko.unwrap(o()).observable;$(e).bind("reset",function(){t(0)})},update:function(e,o){-1===ko.unwrap(o()).value&&$(e).rateit("reset")}},ko.bindingHandlers.ko_styleInfoWindow={init:function(e){for(var o,t,n=$(e).parent().parent().addClass("custom-info-window-subcontainer"),r=n.siblings(),a=0,i=r.length;a<i;a++)if("0px"===$(r[a]).css("top")){o=$(r[a]).addClass("custom-info-window-background-container").children();break}if(o){for(var l=0,s=o.length;l<s;l++)if("rgb(255, 255, 255)"===$(o[l]).css("background-color")){t=$(o[l]).addClass("custom-info-window-background").attr("id","custom-info-window-background");break}t&&(n.parent().parent().parent().addClass("custom-info-window"),t.css({"background-color":"","border-radius":""}))}}},ko.bindingHandlers.setResizeListener={update:function(e,o,t,n,r){var a=ko.unwrap(o());if(e.resizeSensor&&(delete e.resizeSensor,delete e.resizedAttached),void 0!==a){var i=$(e),l=$("#custom-info-window-background"),s=0;void 0===l.get(0)&&(l=i,s=50),clearTimeout(r.$data.currentInfoWindowCheck),new ResizeSensor(e,function(){r.$data.regularInfoWindowPan(!0),$(a.infoWindow.content).height($(a.infoWindow.content).height())}),setTimeout(function(){r.$data.reCheckInfoWindowIsCentered(l,a,s)},75)}}},ko.bindingHandlers.ko_bootstrapTooltip={init:function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}},ko.bindingHandlers.ko_perfectScrollbar={init:function(o){$(o).perfectScrollbar(),$(o).bind("mouseenter",function(e){n(0,o)})},update:function(e,o){ko.utils.unwrapObservable(o()),t($(e))}},ko.bindingHandlers.generateStars={update:function(e,o,t,n,r,a){for(var i,l=(i="function"==typeof o?ko.unwrap(o()):o)-Math.floor(i),s="",c=1;c<=i;c++)s+='<span class="glyphicon glyphicon-star" aria-hidden="true"></span>';if(0<l&&(s+='<span class="glyphicon glyphicon-star partial-width-'+Math.round(10*l)+'" aria-hidden="true"></span>'),""!==s){if(!0===a)return s;$(e).html(s)}}},ko.bindingHandlers.obToImg={update:function(e,o,t,n,r,a){var i,l="";if(void 0!==(i="function"==typeof o?ko.unwrap(o()):o)&&(l+='<img src="'+i+'" alt="observable">'),""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.obToLink={update:function(e,o,t,n,r,a){var i,l="";if(void 0!==(i="function"==typeof o?ko.unwrap(o()):o)&&(l+='<a target="_blank" href="'+i+'">'+i+"</a>"),""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.generateUSD={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;for(var l="",s=1;s<=i;s++)l+='<i class="fa fa-usd"></i>';if(""!==l){if(!0===a)return l;$(e).html(l)}}},ko.bindingHandlers.ko_modal={init:function(e,o){var t=ko.unwrap(o());ko.utils.registerEventHandler(e,"click",function(){$(t).modal()})}},ko.bindingHandlers.menuToggle={init:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggledObservable;ko.utils.registerEventHandler(e,"click",function(){!function(e,o,t){$(e).toggleClass("mobile-button-pressed");var n=$("#"+o);$(e).trigger("mouseleave"),n.hasClass("panel-visible")?(n.removeClass("panel-visible"),!1!==t()&&t(!1)):(n.addClass("panel-visible"),!0!==t()&&t(!0))}(e,n,r)})},update:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggled;$("#"+n).hasClass("panel-visible")&&!1===r&&$(e).click()}},ko.bindingHandlers.scrollToItem={update:function(e,o,t,n,r){ko.utils.unwrapObservable(o()),r.$data.scrollToItem()}},ko.bindingHandlers.infoWindowTemplate={init:function(e,o,t,n,r){$(e).prev().hasClass("info-window-loaded")||ko.renderTemplate("info-window-template-container",r.$data,{},e,"replaceNode")}},ko.bindingHandlers.errorsHandler={update:function(e,o,t,n,r){var a=o().data();if(!1!==a){o().data(!1);var i=o().verbose(),l=a.verbose;if(!0===i||!1===l){var s=a.killOnMarkers,c='<div class="panel ';c+=!0===l?"panel-warning":"panel-danger",c+='"><div class="panel-heading"><h3 class="panel-title">',c+=a.customMessage,c+='</h3></div><div class="panel-body">',c+=a.textStatus,c+="</div></div>",$("#error-container").append(c);var u=$("#error-container").children().last();u.show(200),u.bind("click",v),!0===l&&setTimeout(function(){g(u,200)},3e3),!0===s&&$.doWhen({when:function(){return 0<r.$data.listableEntries().entries.length}}).done(function(){g(u,200)})}}}},ko.bindingHandlers.listOutOpeningHours={update:function(e,o){var t=ko.unwrap(o());if(void 0!==t&&!1!==u(t,"weekday_text","0")){for(var n="",r=0,a=t.weekday_text.length;r<a;r++)n+="<div>"+t.weekday_text[r]+"</div>";e.innerHTML=n}}},ko.bindingHandlers.dropdown={init:function(e){$(e).on("shown.bs.dropdown",function(){var e=$(this).find(".dropdown-menu");if(null!==e&&1===e.length){var o=e.parent(),t=$("#info-window-template");e.position({of:o,my:"left top",at:"left bottom",collision:"flip",within:t})}})},update:function(e,o,t,n,r){var a=o().data,i='<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret caret-dropdown"></span></button><ul class="dropdown-menu dropdown-menu-right">',l=i;for(var s in a){var c;if(!1!==(c=void 0!==a[s].value_binding?f(a[s].value,a[s].value_binding,e,t,n,r):f(a[s].value))){if(l+="<li><strong>"+s+":</strong> <span>"+c+"</span>",void 0!==a[s].value_binding_show_text&&(l+=" ("+f(a[s].value)+")"),void 0!==a[s].value_2)if(void 0!==a[s].value_3)for(var u=2;void 0!==a[s]["value_"+u];){var d=f(a[s]["value_"+u]);!1!==d&&(l+=2===u?"("+d+")":", "+d,void 0===a[s]["value_"+(u+1).toString()]&&void 0!==a[s].append&&(l+=a[s].append)),u++}else{var g=f(a[s].value_2);!1!==g&&(l+=", "+g,void 0!==a[s].append&&(l+=a[s].append))}l+="</li>"}}l!==i&&(l+="</ul>",e.innerHTML=l),$(e).hasClass("open")&&$(e).trigger("shown.bs.dropdown")}};var o=!(ko.extenders.numeric=function(e,o){return ko.computed({read:function(){return Number(e()).toFixed(o)/1},write:e})}),r=!1,a=!1;function k(){alert("Google Maps failed to load. Please try again later.")}return{googleLoaded:function(){a=!0},googleFailedToLoad:k,preloadFontsAndImages:function(){var e={google:{families:["Lato:400,400italic,700:latin","Scheherazade:400,700:latin"]},timeout:1e4,active:function(){r=!0},inactive:function(){r=!0,console.warn("Fonts were not loaded.")}};WebFont.load(e),function(e,o){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=new Image,t[n].src=e[n];"function"==typeof o&&o()}(["img/marker-1.png","img/marker-2.png","img/marker-3.png","img/marker-4.png","img/marker-empty.png","img/marker-heart.png"],function(){o=!0}),$.doWhen({when:function(){return!0===o&&!0===r&&!0===a}}).done(function(){!function(){if("undefined"==typeof google)k();else{var e=new google.maps.LatLng(appConfigObject.defaultLat,appConfigObject.defaultLng),o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom,t=document.getElementById("mapDiv"),n=appConfigObject.mapStyle,r={center:e,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{mapTypeIds:[]},styles:n},a=new google.maps.MarkerImage("img/reticle.png",new google.maps.Size(16,16),new google.maps.Point(0,0),new google.maps.Point(8,8)),i=new google.maps.Map(t,r),l=new h(i);ko.applyBindings(l,document.body);var s=new google.maps.Marker({position:i.getCenter(),map:i,icon:a,shape:{coords:[8,8,8,8],type:"rect"},optimized:!1,zIndex:5}),c=p(function(e){s.setPosition(e)},16,{leading:!1}),u=p(function(){void 0!==l.getRestaurantsFromGoogleMapsAPICallArray[l.getRestaurantsFromGoogleMapsAPICallArray.length-1]&&(l.getRestaurantsFromGoogleMapsAPICallArray[l.getRestaurantsFromGoogleMapsAPICallArray.length-1]=!1),l.getRestaurantsFromGoogleMapsAPICallArray.push(!0),l.getRestaurantsFromGoogleMapsAPI(l.getRestaurantsFromGoogleMapsAPICallArray.length-1)},1200,{trailing:!1}),d=p(function(e){l.checkIfOnMap(l.mainMap.getBounds()),l.mainMapCenter(e),u()},50,{leading:!1});if(google.maps.event.addListener(i,"bounds_changed",function(){var e=i.getCenter();d(e),c(e)}),google.maps.event.addListener(i,"dragstart",function(){l.userDrag(!0)}),!0===l.storageAvailable){var g=JSON.parse(localStorage.getItem("mapCenter"));localStorage.getItem("mapCenter")&&void 0!==g.lat&&null!==g.lat||l.getNavWithCallback()}else l.getNavWithCallback()}}(),$("#loading").fadeOut(500)})}}}();