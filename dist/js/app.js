var app=function(){"use strict";function e(e,o){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=new Image,t[n].src=e[n];"function"==typeof o&&o()}function o(e){for(var o=Array.prototype.slice.call(arguments,1),t=0,n=o.length;t<n;t++){if(!e||!e.hasOwnProperty(o[t]))return!1;e=e[o[t]]}return!0}function t(e,o,t){var n,r,a,i,l,s=function(){var c=A()-i;c<o&&c>=0?n=setTimeout(s,o-c):(n=null,t||(l=e.apply(a,r),n||(a=r=null)))};return function(){a=this,r=arguments,i=A();var c=t&&!n;return n||(n=setTimeout(s,o)),c&&(l=e.apply(a,r),a=r=null),l}}function n(e,o,t){var n,r,a,i=null,l=0;t||(t={});var s=function(){l=t.leading===!1?0:A(),i=null,a=e.apply(n,r),i||(n=r=null)};return function(){var c=A();l||t.leading!==!1||(l=c);var u=o-(c-l);return n=this,r=arguments,u<=0||u>o?(i&&(clearTimeout(i),i=null),l=c,a=e.apply(n,r),i||(n=r=null)):i||t.trailing===!1||(i=setTimeout(s,u)),a}}function r(e,o,t){"undefined"==typeof t&&(t="name");for(var n=new FuzzySet([]),r=0,a=e.length;r<a;r++)n.add(e[r][t]);var i=n.get(o);return null!==i&&i[0][0]>appConfigObject.minFuzzyMatch&&n.values().indexOf(i[0][1])}function a(e,o){for(var t=0,n=e.length;t<n;t++)if(e[t]!==o[t])return!1;return!0}function i(e){try{var o=window[e],t="__storage_test__";return o.setItem(t,t),o.removeItem(t),!0}catch(e){return!1}}function l(){return"undefined"!=typeof Worker&&"file:"!==window.location.protocol}function s(e,t,n,r,a,i){if("undefined"==typeof e||null===e)return!1;if(e.constructor===Array){if("undefined"==typeof e[0])return!1;if(o.apply(void 0,e)!==!0)return!1;for(var l=e[0],s=1,c=e.length;s<c;s++)l=l[e[s]];e=l}return"undefined"!=typeof t&&(e=ko.bindingHandlers[t].update(n,e,r,a,i,!0)),e}function c(e,o,t,n){var r=e.getProjection().fromLatLngToPoint(o instanceof google.maps.LatLng?o:e.getCenter()),a=new google.maps.Point(("number"==typeof t?t:0)/Math.pow(2,e.getZoom())||0,("number"==typeof n?n:0)/Math.pow(2,e.getZoom())||0);e.setCenter(e.getProjection().fromPointToLatLng(new google.maps.Point(r.x-a.x,r.y+a.y)))}function u(e,o,t,n,r,a){setTimeout(function(){var r=0,i=0;if(t===!0){var l=$("#marker-list"),s=10;(window.innerWidth>1199||l.hasClass("panel-visible")===!0)&&l.width()+l.offset().left+e.width()+a+2*s<window.innerWidth&&e.offset().left<l.width()+l.offset().left+s&&(r=l.width()+l.offset().left-e.offset().left+s)}n===!0&&e.offset().top<0&&(i=e.offset().top-15),0===r&&0===i||c(o.marker().map,void 0,r,i)},"undefined"!=typeof r?r:0)}function d(e,o){e.hide(o,function(){e.unbind("click",g),e.remove()})}function g(e){d($(e.currentTarget),50)}function p(e,o){C($(o)),f(o)}function f(e){$(e).unbind("mouseenter",p)}function m(e,o,t){$(e).toggleClass("mobile-button-pressed");var n=$("#"+o);$(e).trigger("mouseleave"),n.hasClass("panel-visible")?(n.removeClass("panel-visible"),t()!==!1&&t(!1)):(n.addClass("panel-visible"),t()!==!0&&t(!0))}function b(e,o){var t=this;t.googleSearchType=ko.observable(o),t.googleIsLoading=ko.observable(!1),t.isInViewOnMap=ko.observable(!0),t.isListed=ko.observable(!1),t.isSelected=ko.observable(!1),t.hasBeenOpened=!1,t.modelNumber=e.getLocationModelNumber(),t.isFavorite=ko.observable(!1),t.disposableArray=[],t.listenerStorage=[],e.modelConstructor(t),e.modelSearchTypeConstructor(t),t.marker=ko.observable(new google.maps.Marker({map:e.mainMap,opacity:t.isListed()===!1?e.lowMarkerOpacity():appConfigObject.highMarkerOpacity,icon:e.markerImageCreator(),shape:appConfigObject.defaultMarkerShape})),t.disposableArray.push(t.isFavorite.subscribe(function(o){t.marker().setIcon(e.markerImageCreator(o,t.google_priceLevel())),t.marker(t.marker()),e.changeFavoriteArray(o,t)})),t.disposableArray.push(t.isSelected.subscribe(function(o){e.changeCurrentlySelectedItem(o,t)})),t.disposableArray.push(t.isListed.subscribe(function(o){o?(t.marker().setOpacity(appConfigObject.highMarkerOpacity),t.marker(t.marker())):(t.marker().setOpacity(e.lowMarkerOpacity()),t.marker(t.marker()))})),t.disposableArray.push(t.google_priceLevel.subscribe(function(o){t.marker().setIcon(e.markerImageCreator(t.isFavorite(),o)),t.marker(t.marker())})),t.disposableArray.push(t.google_name.subscribe(function(e){t.marker().setTitle(e),t.marker(t.marker())})),t.disposableArray.push(t.google_geometry.subscribe(function(e){t.marker().setPosition(e.location),t.marker(t.marker())})),t.isItOpenRightNow=ko.pureComputed(function(){if("undefined"!=typeof t.google_openingHoursObject()){if(t.google_openingHoursObject().open_now===!0)return"Open";if(t.google_openingHoursObject().open_now===!1)return"Closed"}}),t.infoWindow=new google.maps.InfoWindow({content:e.makeInfoWindowContent()}),t.listenerStorage.push(t.infoWindow.addListener("closeclick",e.markerCloseClick)),t.listenerStorage.push(t.infoWindow.addListener("domready",e.markerDomReady)),t.listenerStorage.push(t.marker().addListener("click",function(){e.markerClick(t)})),t.listWasClicked=function(o,n,r){new google.maps.event.trigger(t.marker(),"click"),t.marker().map.panTo(t.google_geometry().location),r<1200&&e.markerToggled(!1)},t.searchType=function(e){return t[e.toLowerCase()+"SearchType"]},t.dispose=function(){t.marker().setMap(null),ko.utils.arrayForEach(t.disposableArray,function(e){e.dispose()}),ko.utils.arrayForEach(t.listenerStorage,function(e){google.maps.event.removeListener(e)})}}function v(e){var s=this;s.mainMap=e,s.mainMapCenter=ko.observable(),s.service=new google.maps.places.PlacesService(s.mainMap),s.storageAvailable=i("localStorage"),s.workersAvailable=l(),s.maxMarkerLimit=ko.observable(appConfigObject.maxMarkerLimit),s.lowMarkerOpacity=ko.observable(appConfigObject.lowMarkerOpacity),s.APIMappingsForModel=appConfigObject.APIMappingsForModel,s.APIConfiguredSearchTypes=appConfigObject.configuredSearchTypes,s.defaultMarkerImage={size:new google.maps.Size(appConfigObject.markerImageSize[0],appConfigObject.markerImageSize[1]),origin:new google.maps.Point(appConfigObject.markerImageOrigin[0],appConfigObject.markerImageOrigin[1]),anchor:new google.maps.Point(appConfigObject.markerImageAnchor[0],appConfigObject.markerImageAnchor[1])},s.markedLocations=ko.observableArray([]),s.locationModelNumber=0,s.currentlySelectedLocation=ko.observable(),s.scrolledItem=ko.observable(),s.shouldScroll=ko.observable(!1),s.attributionsArray=ko.observableArray([]),s.favoriteArray=ko.observableArray([]),s.getRestaurantsFromGoogleMapsAPICallArray=[],s.currentDetailedAPIInfoBeingFetched={},s.errors=ko.observable(!1),s.verboseErrors=ko.observable(!1),s.checkNested=o,s.markerToggled=ko.observable(!1),s.optionsToggled=ko.observable(!1),s.regularInfoWindowPan=ko.observable(!1),s.userDrag=ko.observable(!1),s.currentInfoWindowCheck=void 0,s.sortType=ko.observable("count"),s.searchQuery=ko.observable(),s.priceButtonFilter=ko.observableArray(appConfigObject.defaultPriceButtonFilter),s.minRatingButtonFilter=ko.observable(appConfigObject.defaultMinRatingButtonFilter),s.openButtonFilter=ko.observable(appConfigObject.defaultOpenButtonFilter),s.favoriteButtonFilter=ko.observable(appConfigObject.defaultFavoriteButtonFilter),s.infoWindowHTMLTemplate='<div class = "info-window-template" data-bind = "infoWindowTemplate: true"></div>',s.lowMarkerOpacity.subscribe(function(e){e=Number(e).toFixed(2)/1,ko.utils.arrayForEach(s.markedLocations(),function(o){o.isListed()===!1&&o.marker().setOpacity(e)})}),s.lowMarkerOpacity.extend({numeric:2}),s.mainMapCenter.subscribe(function(e){s.setLocalStorage("mapCenter",JSON.stringify({lat:e.lat(),lng:e.lng(),zoom:s.mainMap.getZoom()}))}),s.markedLocations.subscribe(function(e){e.length>s.maxMarkerLimit()&&s.removeMultipleLocations(e)}),s.favoriteArray.subscribe(function(e){var o=[];ko.utils.arrayForEach(e,function(e){o.push(s.modelDeconstructor(e))});var t=JSON.stringify(o);0!==o.length?s.setLocalStorage("favoritesArray",t):s.setLocalStorage("favoritesArray","[]")}),s.favoriteArray.extend({rateLimit:2e3}),s.currentlySelectedLocation.subscribe(t(function(e){"undefined"!=typeof e&&(s.scrollToItem(),s.userDrag(!1))},5)),s.idArray=ko.pureComputed(function(){var e={all:[],nearby:[]};return ko.utils.arrayMap(s.markedLocations(),function(o){"Nearby"!==o.googleSearchType()&&"Places"!==o.googleSearchType()||e.nearby.push(o.google_placeId),e.all.push(o.google_placeId)}),e}),s.priceButtonFilterHasChanged=ko.pureComputed(function(){return!a(s.priceButtonFilter(),[!0,!0,!0,!0,!0])}),s.listableEntries=ko.computed(function(){var e={entries:[],allNames:[]};return e.entries=ko.utils.arrayFilter(s.markedLocations(),function(o){return"Nearby"!==o.googleSearchType()&&"Places"!==o.googleSearchType()||o.isInViewOnMap()!==!0||s.isSearchFiltered(o)!==!1||s.isButtonFiltered(o)!==!1?(o.isListed(!1),!1):(o.isListed(!0),e.allNames.push(o.google_name()),!0)}),e}),s.sortedEntries=ko.pureComputed(function(){var e=s.listableEntries().entries;return"count"===s.sortType()?e.sort(function(e,o){return e.modelNumber<o.modelNumber?-1:1}):"alpha"===s.sortType()?e.sort(function(e,o){return e.google_name()===o.google_name()?0:e.google_name()<o.google_name()?-1:1}):"rating"===s.sortType()?e.sort(function(e,o){return"undefined"==typeof e.google_rating()?"undefined"==typeof o.google_rating()?0:1:"undefined"==typeof o.google_rating()?-1:e.google_rating()<o.google_rating()?1:-1}):"distance"===s.sortType()&&e.sort(function(e,o){var t=e.google_geometry().location.lat(),n=o.google_geometry().location.lat(),r=s.mainMapCenter().lat(),a=e.google_geometry().location.lng(),i=o.google_geometry().location.lng(),l=s.mainMapCenter().lng(),c=appConfigObject.distanceBetweenTwoPointsInMeters(t,a,r,l),u=appConfigObject.distanceBetweenTwoPointsInMeters(n,i,r,l);return c===u?0:c<u?-1:1}),e}),s.listableEntries.extend({rateLimit:50}),s.initializeCurrentDetailedAPIInfoBeingFetched=function(){s.currentDetailedAPIInfoBeingFetched.findID=function(e,o,t){return this[e][o].indexOf(t)},s.currentDetailedAPIInfoBeingFetched.pushID=function(e,o,t){this[e][o].push(t),this[e][o][this[e][o].length-1][e+"IsLoading"](!0)},s.currentDetailedAPIInfoBeingFetched.removeID=function(e,o,t){var n=this.findID(e,o,t);n>-1&&(this[e][o][n][e+"IsLoading"](!1),this[e][o].splice(n,1));for(var r=0,a=this.intercept.length;r<a;r++)this.intercept[r].ID===t&&(s.getDetailedAPIData(this.intercept[r].service,this.intercept[r].ID),this.intercept.splice(r,1))},s.currentDetailedAPIInfoBeingFetched.intercept=[],s.currentDetailedAPIInfoBeingFetched.interceptIDPush=function(e,o,t){for(var n=0,r=this.intercept.length;n<r;n++)if(this.intercept.ID===t)return;this.intercept.push({ID:t,type:o,service:e})},s.currentDetailedAPIInfoBeingFetched.interceptIDRemove=function(e){for(var o=0,t=this.intercept.length;o<t;o++)this.intercept.ID===e&&this.intercept.splice(o,1)};for(var e=0,o=s.APIConfiguredSearchTypes.length;e<o;e++)s.currentDetailedAPIInfoBeingFetched[s.APIConfiguredSearchTypes[e]]={basic:[],detailed:[]};s.currentDetailedAPIInfoBeingFetched.google={detailed:[]}},s.changeCurrentlySelectedItem=function(e,o){e===!0?s.currentlySelectedLocation(o):s.currentlySelectedLocation(void 0)},s.changeFavoriteArray=function(e,o){e===!0?s.favoriteArray.push(o):s.favoriteArray.remove(o)},s.markerCloseClick=function(){"undefined"!=typeof s.currentlySelectedLocation()&&(s.currentlySelectedLocation().hasBeenOpened=!1,s.currentlySelectedLocation().isSelected(!1))},s.markerDomReady=function(){s.currentlySelectedLocation().hasBeenOpened||(ko.applyBindings(s,s.currentlySelectedLocation().infoWindow.getContent()),s.currentlySelectedLocation().hasBeenOpened=!0)},s.markerClick=function(e){e.hasBeenOpened===!0&&(e.hasBeenOpened=!1),s.shouldScroll(!0),s.getDetailedGooglePlacesAPIInfo(e,s.callSearchAPIs),"undefined"!=typeof s.currentlySelectedLocation()&&(s.currentlySelectedLocation().infoWindow.close(),s.currentlySelectedLocation().isSelected(!1)),e.isSelected(!0),s.markerAnimation(e),e.infoWindow.open(e.marker().map,e.marker())},s.markerAnimation=function(e){e.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker().setAnimation(null)},750)},s.markerImageCreator=function(e,o){var t=s.defaultMarkerImage;if(e===!0)return t.url=appConfigObject.markerImageURLFav,t;switch(o){case 1:return t.url=appConfigObject.markerImageURL1,t;case 2:return t.url=appConfigObject.markerImageURL2,t;case 3:return t.url=appConfigObject.markerImageURL3,t;case 4:return t.url=appConfigObject.markerImageURL4,t;default:return t.url=appConfigObject.markerImageURLEmpty,t}},s.getNavWithCallback=function(){return!!navigator.geolocation&&navigator.geolocation.getCurrentPosition(s.mapPanFromNavigation)},s.mapPanFromNavigation=function(e){s.mapPan(e.coords.latitude,e.coords.longitude),s.markerCloseClick(),s.optionsToggled(!1)},s.mapPan=function(e,o){var t=new google.maps.LatLng(e,o);s.mainMap.panTo(t)},s.modelConstructor=function(e){for(var o in s.APIMappingsForModel)for(var t=s.APIMappingsForModel[o],n=0,r=t.length;n<r;n++)1===t[n].oType?e[t[n].model]=ko.observable():2===t[n].oType&&(e[t[n].model]=ko.observableArray([]))},s.modelDeconstructor=function(e){var o={};for(var t in s.APIMappingsForModel)for(var n=s.APIMappingsForModel[t],r=0,a=n.length;r<a;r++)0===n[r].oType?o[n[r].model]=e[n[r].model]:o[n[r].model]=e[n[r].model]();return o},s.modelUpdater=function(e,o,t){for(var n=s.APIMappingsForModel[o],r=0,a=n.length;r<a;r++)"undefined"!=typeof t[n[r].server]&&(0!==n[r].oType?e[n[r].model](t[n[r].server]):e[n[r].model]=t[n[r].server])},s.modelRebuilder=function(e,o,t){for(var n in s.APIMappingsForModel)for(var r=s.APIMappingsForModel[n],a=0,i=r.length;a<i;a++)if(0!==r[a].oType&&"google_geometry"!==r[a].model)e[r[a].model](o[r[a].model]);else if("google_geometry"===r[a].model){var l=o[r[a].model];l.location=t,e[r[a].model](l)}else e[r[a].model]=o[r[a].model]},s.modelSearchTypeConstructor=function(e){for(var o=0,t=s.APIConfiguredSearchTypes.length;o<t;o++)e[s.APIConfiguredSearchTypes[o].toLowerCase()+"SearchType"]=ko.observable("None"),e[s.APIConfiguredSearchTypes[o].toLowerCase()+"IsLoading"]=ko.observable(!1)},s.removeMultipleLocations=n(function(e){s.markedLocations.sort(function(e,o){return e.isFavorite()===!0?1:e.modelNumber<o.modelNumber?-1:1});for(var o=0;o<appConfigObject.markerLimitRemoveBulkAmount;o++)e[o].dispose();s.markedLocations.splice(0,appConfigObject.markerLimitRemoveBulkAmount)},1e3,{trailing:!1}),s.getLocationModelNumber=function(){return s.locationModelNumber++,s.locationModelNumber-1},s.setLocalStorage=n(function(e,o){s.storageAvailable===!0&&localStorage.setItem(e,o)},1e3,{trailing:!1}),s.locationArrayForWorkers=function(){return ko.utils.arrayMap(s.listableEntries().entries,function(e){return{lat:e.google_geometry().location.lat(),lng:e.google_geometry().location.lng(),name:e.google_name(),google_placeId:e.google_placeId}})},s.isSearchFiltered=function(e){return"undefined"!=typeof s.searchQuery()&&!(e.google_name().toLowerCase().indexOf(s.searchQuery().toLowerCase())>=0)},s.isButtonFiltered=function(e){if(s.priceButtonFilterHasChanged()===!0)if("undefined"!=typeof e.google_priceLevel()){for(var o=0;o<5;o++)if(s.priceButtonFilter()[o]!==!0&&e.google_priceLevel()===o)return!0}else if(s.priceButtonFilter()[0]!==!0)return!0;if(0!==s.minRatingButtonFilter()){if("undefined"==typeof e.google_rating())return!0;if(e.google_rating()<s.minRatingButtonFilter())return!0}return s.openButtonFilter()!==!1&&"Open"!==e.isItOpenRightNow()||s.favoriteButtonFilter()!==!1&&e.isFavorite()!==!0},s.scrollToItem=function(){"undefined"!=typeof s.currentlySelectedLocation()&&s.shouldScroll()===!0&&s.scrolledItem(s.currentlySelectedLocation())},s.makeInfoWindowContent=function(){var e=s.infoWindowHTMLTemplate;return e=$.parseHTML(e)[0]},s.checkIfOnMap=function(e){ko.utils.arrayForEach(s.markedLocations(),function(o){e.contains(o.google_geometry().location)===!1?o.isInViewOnMap(!1):o.isInViewOnMap(!0)})},s.compareIDs=function(e){return ko.utils.arrayFirst(s.markedLocations(),function(o){return o.google_placeId===e})},s.successAPIFunction=function(e,o,t,n,a,i,l){var c;if(c="undefined"!=typeof a?"basic":"detailed","basic"===c){var u=r(e,o.google_name());"number"==typeof u?(t(o),s.modelUpdater(o,n,e[u]),e.splice(u,1)):(t(o,"Not Found"),s.failAPIFunction(n.toProperCase()+" Search Problem","No Match Found",void 0,!0));var d={resultsArray:e,locationsArray:a,initialPoint:i,maxDistance:appConfigObject.latLngAccuracy,service:n,minFuzzyMatch:appConfigObject.minFuzzyMatch,workerHandler:l};s.workerHandler(d,n,t)}else t(o),s.modelUpdater(o,n,e)},s.failAPIFunction=function(e,o,t,n){"undefined"==typeof n&&(n=!1);var r,a;switch(o){case"ZERO_RESULTS":r="No results found from Google. Try zooming out?",a=!0;break;case"OVER_QUERY_LIMIT":r="Requests are being throttled by Google. Usually caused by panning the map too quickly. Give it 10-20 seconds",a=!1;break;default:r=o,a=!1}var i={};i.customMessage=e,i.textStatus=r,i.verbose=n,i.killOnMarkers=a,s.errors(i),t&&console.warn(t)},s.getDetailedAPIData=function(e,o){"None"===o.searchType(e)()?(s.currentDetailedAPIInfoBeingFetched.findID(e,"basic",o)===-1&&s.callBasicAPIData(e,o),s.currentDetailedAPIInfoBeingFetched.interceptIDPush(e,"detailed",o)):"Basic"===o.searchType(e)()&&s.currentDetailedAPIInfoBeingFetched.findID(e,"detailed",o)===-1&&(s.currentDetailedAPIInfoBeingFetched.pushID(e,"detailed",o),s.callAPIInfo("detailed",e,o))},s.callSearchAPIs=function(e){for(var o=ko.toJS(s.locationArrayForWorkers()),t=0,n=s.APIConfiguredSearchTypes.length;t<n;t++){var r=s.APIConfiguredSearchTypes[t];"None"===e.searchType(r)()&&s.currentDetailedAPIInfoBeingFetched.findID(r,"basic",e)===-1&&s.callBasicAPIData(r,e,o)}},s.callBasicAPIData=function(e,o,t){"undefined"==typeof t&&(t=ko.toJS(s.locationArrayForWorkers())),s.currentDetailedAPIInfoBeingFetched.pushID(e,"basic",o),s.callAPIInfo("basic",e,o,t)},s.checkAndAddFullAttributions=function(e){for(var o=[],t=0,n=e.length;t<n;t++)s.attributionsArray.indexOf(e[t])===-1&&o.push(e[t]);s.attributionsArray.push.apply(s.attributionsArray,o)},s.processNearbyResults=function(e,o,t,n){if(o!==google.maps.places.PlacesServiceStatus.OK)return void s.failAPIFunction("Google Maps Nearby Search Error",o);for(var r=[],a=0,i=e.length;a<i;a++)if(s.idArray().nearby.indexOf(e[a].place_id)===-1){if(s.idArray().all.indexOf(e[a].place_id)===-1){var l=new b(s,"Nearby");s.successAPIFunction(e[a],l,function(){},"google"),r.push(l)}else{var c=s.compareIDs(e[a].place_id);c&&s.successAPIFunction(e[a],c,s.setAPIResultSearchType("Nearby","google").setSearchType,"google")}0!==e[a].html_attributions.length&&s.checkAndAddFullAttributions(e[a].html_attributions)}s.markedLocations.push.apply(s.markedLocations,r),t&&t.hasNextPage&&setTimeout(function(){s.getRestaurantsFromGoogleMapsAPICallArray[n]===!0&&t.nextPage()},2e3)},s.processRadarResults=function(e,o){if(o!==google.maps.places.PlacesServiceStatus.OK)return void s.failAPIFunction("Google Maps Radar Search Error",o);for(var t=[],n=0,r=e.length;n<r;n++){if(s.idArray().all.indexOf(e[n].place_id)===-1){var a=new b(s,"Radar");s.successAPIFunction(e[n],a,function(){},"google"),t.push(a)}0!==e[n].html_attributions.length&&s.checkAndAddFullAttributions(e[n].html_attributions)}s.markedLocations.push.apply(s.markedLocations,t)},s.getRestaurantsFromGoogleMapsAPI=function(e){var o=s.mainMap.getBounds(),t={bounds:o,types:["restaurant"]};s.service.radarSearch(t,s.processRadarResults),s.service.nearbySearch(t,function(o,t,n){s.processNearbyResults(o,t,n,e)})},s.getDetailedGooglePlacesAPIInfo=function(e,o){s.currentDetailedAPIInfoBeingFetched.findID("google","detailed",e)===-1&&(s.currentDetailedAPIInfoBeingFetched.pushID("google","detailed",e),s.service.getDetails({placeId:e.google_placeId},function(t,n){return s.currentDetailedAPIInfoBeingFetched.removeID("google","detailed",e),n!==google.maps.places.PlacesServiceStatus.OK?void s.failAPIFunction("Google Places Search Error",n):(s.successAPIFunction(t,e,s.setAPIResultSearchType("Places","google").setSearchType,"google"),void o(e))}))},s.setAPIResultSearchType=function(e,o){function t(e,o){var t=n.type.toProperCase();o&&(t=o),e.searchType(n.service)(t)}var n={type:e,service:o};return{setSearchType:t}},s.callAPIInfo=function(e,o,t,n,r){var a,i,l,c=appConfigObject[o+"_searchAPIProperties"],u=c.settings;if(u.url=c[e+"_URL"],"basic"!==e&&(u.url+=t[o+"_id"](),c.extraSlash===!0&&(u.url+="/")),"basic"===e){a=t.google_geometry().location.lat(),i=t.google_geometry().location.lng(),l={lat:a,lng:i};for(var d in c.basicExtraParameters)"function"==typeof c.basicExtraParameters[d]?u.data[d]=c.basicExtraParameters[d](a,i):u.data[d]=c.basicExtraParameters[d]}for(var g in c.allExtraParameters)u.data[g]=c.allExtraParameters[g](u.url,u.data);u.success=function(r){var a=r;if("object"==typeof c[e+"_returnType"])for(var i=0,u=c[e+"_returnType"].length;i<u;i++)a=a[c[e+"_returnType"][i]];else a="undefined"!=typeof c[e+"_returnType"]?a[c[e+"_returnType"]]:r;"undefined"!=typeof a?s.successAPIFunction(a,t,s.setAPIResultSearchType(e,o).setSearchType,o,n,l,c.workerHandler):(s.currentDetailedAPIInfoBeingFetched.interceptIDRemove(t),console.debug(r),s.failAPIFunction(o.toProperCase()+" "+e.toProperCase()+" Search Error","Could not interpret results"))},u.error=function(n,r,a){s.currentDetailedAPIInfoBeingFetched.interceptIDRemove(t),s.failAPIFunction(o.toProperCase()+" "+e.toProperCase()+" Search Error",r,a)},u.complete=function(){s.currentDetailedAPIInfoBeingFetched.removeID(o,e,t)},$.ajax(u),"function"==typeof r&&r()},s.getGooglePhotoURL=function(e,o){return"function"==typeof e.getUrl?e.getUrl(o):""},s.avoidMemeoryLeaksDueToEventListeners=function(e){return e=void 0},s.workerHandler=function(e,o,t){if(s.workersAvailable===!0){var n=new Worker("/js/workerFillMarkerData.js");n.onmessage=function(e){for(var r=e.data,a=0,i=r.length;a<i;a++){var l=s.compareIDs(r[a].google_placeId);t(l),s.modelUpdater(l,o,r[a])}s.avoidMemeoryLeaksDueToEventListeners(n)},n.postMessage(e)}},s.getLocalStorage=function(){if(s.storageAvailable===!0){if(localStorage.getItem("favoritesArray")){var e=JSON.parse(localStorage.getItem("favoritesArray"));if(null!==e){for(var o=[],t=0,n=e.length;t<n;t++){var r=new b(s,"Nearby"),a=Number(e[t].google_geometry.location.lat),i=Number(e[t].google_geometry.location.lng),l=new google.maps.LatLng(a,i);s.modelRebuilder(r,e[t],l),r.google_geometry(r.google_geometry()),r.isFavorite(!0),r.google_openingHoursObject(void 0),o.push(r)}s.markedLocations.push.apply(s.markedLocations,o)}}if(localStorage.getItem("mapCenter")){var c=JSON.parse(localStorage.getItem("mapCenter"));null!==c&&"undefined"!=typeof c.lat&&null!==c.lat&&(s.mapPan(c.lat,c.lng),null!==c.zoom&&"number"==typeof c.zoom&&s.mainMap.setZoom(c.zoom))}}},s.singleErrorMessages=function(){s.storageAvailable!==!0&&s.failAPIFunction("Local Storage Problem","Local Storage support is not available. Favorites will not save after page reload."),s.workersAvailable!==!0&&s.failAPIFunction("Web Workers Problem","Web Workers support is not available. App will function normally but average data retrieval wait times will increase. \n Web workers do not work when loading this application from older browsers or directly from the local file system.")},s.reCheckInfoWindowIsCentered=function(e,o,t){var n=100;s.regularInfoWindowPan()===!0&&(n=600,s.regularInfoWindowPan(!1)),s.userDrag()!==!0&&"undefined"!=typeof s.currentlySelectedLocation()&&s.currentlySelectedLocation()===o||(n=!1),n!==!1&&(u(e,o,!0,!0,0,t),s.currentInfoWindowCheck=setTimeout(function(){s.reCheckInfoWindowIsCentered(e,o,t)},n))},s.resetFilters=function(){s.searchQuery(""),s.priceButtonFilter(appConfigObject.defaultPriceButtonFilter),s.minRatingButtonFilter(-1),s.openButtonFilter(appConfigObject.defaultOpenButtonFilter),s.favoriteButtonFilter(appConfigObject.defaultFavoriteButtonFilter)},s.initializeCurrentDetailedAPIInfoBeingFetched(),s.singleErrorMessages(),s.getLocalStorage()}function h(){var o={google:{families:["Lato:400,400italic,700:latin","Scheherazade:400,700:latin"]},timeout:1e4,active:function(){F=!0},inactive:function(){F=!0,console.warn("Fonts were not loaded.")}};WebFont.load(o),e(["img/marker-1.png","img/marker-2.png","img/marker-3.png","img/marker-4.png","img/marker-empty.png","img/marker-heart.png"],function(){P=!0}),I()}function y(){alert("Google Maps failed to load. Please try again later.")}function k(){S=!0}function I(){$.doWhen({when:function(){return P===!0&&F===!0&&S===!0}}).done(function(){w(),$("#loading").fadeOut(500)})}function w(){if("undefined"==typeof google)y();else{var e=new google.maps.LatLng(appConfigObject.defaultLat,appConfigObject.defaultLng),o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom,t=document.getElementById("mapDiv"),r=appConfigObject.mapStyle,a={center:e,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{mapTypeIds:[]},styles:r},i=new google.maps.MarkerImage("img/reticle.png",new google.maps.Size(16,16),new google.maps.Point(0,0),new google.maps.Point(8,8)),l={coords:[8,8,8,8],type:"rect"},s=new google.maps.Map(t,a),c=new v(s);ko.applyBindings(c,document.body);var u=new google.maps.Marker({position:s.getCenter(),map:s,icon:i,shape:l,optimized:!1,zIndex:5}),d=n(function(e){u.setPosition(e)},16,{leading:!1}),g=n(function(){"undefined"!=typeof c.getRestaurantsFromGoogleMapsAPICallArray[c.getRestaurantsFromGoogleMapsAPICallArray.length-1]&&(c.getRestaurantsFromGoogleMapsAPICallArray[c.getRestaurantsFromGoogleMapsAPICallArray.length-1]=!1),c.getRestaurantsFromGoogleMapsAPICallArray.push(!0),c.getRestaurantsFromGoogleMapsAPI(c.getRestaurantsFromGoogleMapsAPICallArray.length-1)},1200,{trailing:!1}),p=n(function(e){c.checkIfOnMap(c.mainMap.getBounds()),c.mainMapCenter(e),g()},50,{leading:!1});if(google.maps.event.addListener(s,"bounds_changed",function(){var e=s.getCenter();p(e),d(e)}),google.maps.event.addListener(s,"dragstart",function(){c.userDrag(!0)}),c.storageAvailable===!0){var f=JSON.parse(localStorage.getItem("mapCenter"));localStorage.getItem("mapCenter")&&"undefined"!=typeof f.lat&&null!==f.lat||c.getNavWithCallback()}else c.getNavWithCallback()}}String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var A=Date.now||function(){return(new Date).getTime()},C=n(function(e){e.perfectScrollbar("update")},16,{leading:!1});ko.bindingHandlers.ko_autocomplete={init:function(e,o){$(e).autocomplete(o())},update:function(e,o,t){$(e).autocomplete({source:function(e,t){var n=$.ui.autocomplete.filter(o().source,e.term);t(n.slice(0,6))},select:function(e,o){t().textInput(o.item.value)}})}},ko.bindingHandlers.textInputForAutocomplete={update:function(e,o){var t=ko.unwrap(o());""===t&&$(e).trigger("change")}},ko.bindingHandlers.focusBox={init:function(e){$(e).on("input change autocompletechange",function(){var e=$(this).val(),o=$(this);o.hasClass("search-box-focused")?"undefined"!=typeof e&&""!==e||o.removeClass("search-box-focused"):"undefined"!=typeof e&&""!==e&&o.addClass("search-box-focused")})}},ko.bindingHandlers.addressAutocomplete={init:function(e,o,t,n,r){var a=t(),i=r.$data.mainMap,l=o(),s=r.$data.markerCloseClick,c={types:["geocode"]};ko.utils.extend(c,a.autocompleteOptions);var u=new google.maps.places.Autocomplete(e,c);u.bindTo("bounds",i),u.addListener("place_changed",function(){s(),l(!1),$.slidebars.close();var e=u.getPlace();if(e.geometry)if(e.geometry.viewport)i.fitBounds(e.geometry.viewport);else{i.setCenter(e.geometry.location);var o=window.innerWidth<992?appConfigObject.defaultMobileZoom:appConfigObject.defaultZoom;i.setZoom(o)}})},update:function(e,o){ko.bindingHandlers.value.update(e,o())}},ko.bindingHandlers.ko_slideOutMenu={init:function(){$.slidebars()}},ko.bindingHandlers.scrollTo={update:function(e,o){var t=o(),r=ko.unwrap(t);if(r){var a=n(function(){$(e).scrollintoview({duration:100})},50);a()}}},ko.bindingHandlers.hoverToggle={init:function(e,o,t,n,r){ko.utils.registerEventHandler(e,"mouseover",function(){r.$data.shouldScroll(!1),$(e).stop(!1,!0)})}},ko.bindingHandlers.ko_slider={init:function(e,o,t,n,r){ko.bindingHandlers.value.init(e,o,t,n,r);var a=o();a.value=o().value(),$(e).slider(a).on("slidechange",function(e,t){o().value(t.value)})}},ko.bindingHandlers.ko_rateit={init:function(e,o){var t=ko.unwrap(o()).observable;$(e).bind("reset",function(){t(0)})},update:function(e,o){var t=ko.unwrap(o()).value;t===-1&&$(e).rateit("reset")}},ko.bindingHandlers.ko_styleInfoWindow={init:function(e){for(var o,t,n=$(e).parent().parent().addClass("custom-info-window-subcontainer"),r=n.siblings(),a=0,i=r.length;a<i;a++)if("0px"===$(r[a]).css("top")){o=$(r[a]).addClass("custom-info-window-background-container").children();break}if(o){for(var l=0,s=o.length;l<s;l++)if("rgb(255, 255, 255)"===$(o[l]).css("background-color")){t=$(o[l]).addClass("custom-info-window-background").attr("id","custom-info-window-background");break}t&&(n.parent().parent().parent().addClass("custom-info-window"),t.css({"background-color":"","border-radius":""}))}}},ko.bindingHandlers.setResizeListener={update:function(e,o,t,n,r){var a=ko.unwrap(o());if(e.resizeSensor&&(delete e.resizeSensor,delete e.resizedAttached),"undefined"!=typeof a){var i=$(e),l=$("#custom-info-window-background"),s=0;"undefined"==typeof l.get(0)&&(l=i,s=50),clearTimeout(r.$data.currentInfoWindowCheck),new ResizeSensor(e,function(){r.$data.regularInfoWindowPan(!0),$(a.infoWindow.content).height($(a.infoWindow.content).height())}),setTimeout(function(){r.$data.reCheckInfoWindowIsCentered(l,a,s)},75)}}},ko.bindingHandlers.ko_bootstrapTooltip={init:function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}},ko.bindingHandlers.ko_perfectScrollbar={init:function(e){$(e).perfectScrollbar(),$(e).bind("mouseenter",function(o){p(o,e)})},update:function(e,o){ko.utils.unwrapObservable(o()),C($(e))}},ko.bindingHandlers.generateStars={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;for(var l=Math.floor(i),s=i-l,c="",u=1;u<=i;u++)c+='<span class="glyphicon glyphicon-star" aria-hidden="true"></span>';if(s>0&&(c+='<span class="glyphicon glyphicon-star partial-width-'+Math.round(10*s)+'" aria-hidden="true"></span>'),""!==c){if(a===!0)return c;$(e).html(c)}}},ko.bindingHandlers.obToImg={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;var l="";if("undefined"!=typeof i&&(l+='<img src="'+i+'" alt="observable">'),""!==l){if(a===!0)return l;$(e).html(l)}}},ko.bindingHandlers.obToLink={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;var l="";if("undefined"!=typeof i&&(l+='<a target="_blank" href="'+i+'">'+i+"</a>"),""!==l){if(a===!0)return l;$(e).html(l)}}},ko.bindingHandlers.generateUSD={update:function(e,o,t,n,r,a){var i;i="function"==typeof o?ko.unwrap(o()):o;for(var l="",s=1;s<=i;s++)l+='<i class="fa fa-usd"></i>';if(""!==l){if(a===!0)return l;$(e).html(l)}}},ko.bindingHandlers.ko_modal={init:function(e,o){var t=ko.unwrap(o());ko.utils.registerEventHandler(e,"click",function(){$(t).modal()})}},ko.bindingHandlers.menuToggle={init:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggledObservable;ko.utils.registerEventHandler(e,"click",function(){m(e,n,r)})},update:function(e,o){var t=ko.unwrap(o()),n=t.menu,r=t.toggled;$("#"+n).hasClass("panel-visible")&&r===!1&&$(e).click()}},ko.bindingHandlers.scrollToItem={update:function(e,o,t,n,r){ko.utils.unwrapObservable(o()),r.$data.scrollToItem()}},ko.bindingHandlers.infoWindowTemplate={init:function(e,o,t,n,r){$(e).prev().hasClass("info-window-loaded")||ko.renderTemplate("info-window-template-container",r.$data,{},e,"replaceNode")}},ko.bindingHandlers.errorsHandler={update:function(e,o,t,n,r){var a=o().data();if(a!==!1){o().data(!1);var i=o().verbose(),l=a.verbose;if(i===!0||l===!1){var s=a.killOnMarkers,c=a.customMessage,u=a.textStatus,p='<div class="panel ';p+=l===!0?"panel-warning":"panel-danger",p+='"><div class="panel-heading"><h3 class="panel-title">',p+=c,p+='</h3></div><div class="panel-body">',p+=u,p+="</div></div>",$("#error-container").append(p);var f=$("#error-container").children().last();f.show(200),f.bind("click",g),
l===!0&&setTimeout(function(){d(f,200)},3e3),s===!0&&$.doWhen({when:function(){return r.$data.listableEntries().entries.length>0}}).done(function(){d(f,200)})}}}},ko.bindingHandlers.listOutOpeningHours={update:function(e,t){var n=ko.unwrap(t());if("undefined"!=typeof n&&o(n,"weekday_text","0")!==!1){for(var r="",a=0,i=n.weekday_text.length;a<i;a++)r+="<div>"+n.weekday_text[a]+"</div>";e.innerHTML=r}}},ko.bindingHandlers.dropdown={init:function(e){$(e).on("shown.bs.dropdown",function(){var e=$(this).find(".dropdown-menu");if(null!==e&&1===e.length){var o=e.parent(),t=$("#info-window-template");e.position({of:o,my:"left top",at:"left bottom",collision:"flip",within:t})}})},update:function(e,o,t,n,r){var a=o().data,i='<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret caret-dropdown"></span></button><ul class="dropdown-menu dropdown-menu-right">',l=i;for(var c in a){var u;if(u="undefined"!=typeof a[c].value_binding?s(a[c].value,a[c].value_binding,e,t,n,r):s(a[c].value),u!==!1){if(l+="<li><strong>"+c+":</strong> <span>"+u+"</span>","undefined"!=typeof a[c].value_binding_show_text&&(l+=" ("+s(a[c].value)+")"),"undefined"!=typeof a[c].value_2)if("undefined"!=typeof a[c].value_3)for(var d=2;"undefined"!=typeof a[c]["value_"+d];){var g=s(a[c]["value_"+d]);g!==!1&&(l+=2===d?"("+g+")":", "+g,"undefined"==typeof a[c]["value_"+(d+1).toString()]&&"undefined"!=typeof a[c].append&&(l+=a[c].append)),d++}else{var p=s(a[c].value_2);p!==!1&&(l+=", "+p,"undefined"!=typeof a[c].append&&(l+=a[c].append))}l+="</li>"}}l!==i&&(l+="</ul>",e.innerHTML=l),$(e).hasClass("open")&&$(e).trigger("shown.bs.dropdown")}},ko.extenders.numeric=function(e,o){var t=ko.computed({read:function(){var t=Number(e()).toFixed(o)/1;return t},write:e});return t};var P=!1,F=!1,S=!1;return{googleLoaded:k,googleFailedToLoad:y,preloadFontsAndImages:h}}();